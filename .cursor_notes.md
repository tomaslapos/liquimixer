# LiquiMixer - PoznÃ¡mky pro AI asistenta

## âš ï¸ KRITICKÃ PRAVIDLA - PÅ˜EÄŒTI PÅ˜ED KAÅ½DOU PRACÃ!

### 1. NIKDY NEPOUÅ TÄšT POWERSHELL PRO EDITACI SOUBORÅ®!

**ProÄ:**
- PowerShell na Windows mÃ¡ fatÃ¡lnÃ­ problÃ©my s UTF-8 kÃ³dovÃ¡nÃ­m
- Cesta `C:\Users\TomÃ¡Å¡Lapos` se rozpadne na `C:\Users\Tomï¿½ï¿½ï¿½Lapos`
- ÄŒeskÃ© znaky se zniÄÃ­: `Å½Ã¡dnÃ¡` â†’ `â”¼Å»â”œÃ­dnâ”œÃ­`, `pÅ™Ã­chuÅ¥` â†’ `pâ”¼Ã–â”œÅŸchuâ”¼Ä…`
- Emoji se rozpadnou: `ğŸ‘¤` â†’ `Â­ÄÄ¹Ä„`, `â˜…` â†’ `Ã”Å›Å¯`, `ğŸ—‘ï¸` â†’ `Ã”Å¥Ä½`

**Co se stalo v minulosti:**
- Dne 7.1.2026 byl celÃ½ `app.js` poÅ¡kozen PowerShell pÅ™Ã­kazy
- Muselo se ruÄnÄ› opravovat stovky Å™Ã¡dkÅ¯ s poÅ¡kozenÃ½mi znaky
- UÅ¾ivatel explicitnÄ› zakÃ¡zal pouÅ¾Ã­vat PowerShell

**Jak sprÃ¡vnÄ›:**
- Pro editaci souborÅ¯: VÃHRADNÄš nÃ¡stroje Cursor (`search_replace`, `write`, `read_file`)
- Pro Git operace: `cmd /c "git add -A && git commit -m 'message' && git push"`
- Pro kopÃ­rovÃ¡nÃ­ souborÅ¯: `cmd /c "robocopy source dest /E"` s krÃ¡tkou cestou `TOMLAP~1`
- KrÃ¡tkÃ¡ cesta uÅ¾ivatele: `C:\Users\TOMLAP~1\Liquimixer`

**ZAKÃZANÃ‰ pÅ™Ã­kazy:**
```
âŒ Set-Content, Add-Content, Out-File
âŒ [System.IO.File]::WriteAllText()
âŒ (Get-Content file) -replace
âŒ jakÃ½koliv PowerShell pÅ™Ã­kaz co zapisuje do souboru
```

### 2. PÅ˜EKLADY NEDÄšLAT SKRIPTEM!

**ProÄ:**
- AutomatickÃ© skripty (generate-locales.js, complete-translations.js) NEFUNGUJÃ
- GenerujÃ­ neplatnÃ½ JSON nebo chybnÃ© pÅ™eklady
- UÅ¾ivatel to explicitnÄ› zakÃ¡zal po opakovanÃ½ch selhÃ¡nÃ­ch

**Jak sprÃ¡vnÄ› pÅ™idÃ¡vat pÅ™eklady:**

1. **ReferenÄnÃ­ soubor:** `locales/cs.json` - VÅ½DY porovnÃ¡vat s tÃ­mto
2. **Postup pro novÃ½ klÃ­Ä:**
   - NajÃ­t v `cs.json` kde klÃ­Ä patÅ™Ã­ (napÅ™. sekce `save_recipe`, `reminder`, `recipe_detail`)
   - OtevÅ™Ã­t JEDEN jazykovÃ½ soubor (napÅ™. `de.json`)
   - PÅ™idat klÃ­Ä s pÅ™eloÅ¾enÃ½m textem
   - Opakovat pro dalÅ¡Ã­ jazyky POSTUPNÄš
3. **Kontrola JSON syntaxe:** Po kaÅ¾dÃ© ÃºpravÄ› ovÄ›Å™it validitu JSON

**Struktura klÃ­ÄÅ¯:**
```json
{
  "meta": { "code": "cs", "name": "ÄŒeÅ¡tina" },
  "nav": { "home": "DomÅ¯", "menu": "Menu" },
  "auth": { "login": "PÅ™ihlÃ¡sit", "logout": "OdhlÃ¡sit" },
  "form": { "amount": "MnoÅ¾stvÃ­", "ratio": "PomÄ›r" },
  "results": { "title": "VÃ½sledky", "total": "Celkem" },
  "save_recipe": { "title": "UloÅ¾it recept", "save_button": "UloÅ¾it" },
  "reminder": { "add_title": "PÅ™idat pÅ™ipomÃ­nku", "mixed_on": "NamÃ­chÃ¡no" },
  "recipe_detail": { "reminders_title": "PÅ™ipomÃ­nky zrÃ¡nÃ­" },
  "common": { "save": "UloÅ¾it", "cancel": "ZruÅ¡it", "delete": "Smazat" }
}
```

**31 podporovanÃ½ch jazykÅ¯:**
cs, en, de, fr, es, it, pl, ru, pt, nl, ja, ko, zh-CN, zh-TW, ar-SA, 
sv, da, fi, no, hr, sr, bg, ro, lt, lv, et, hu, el, uk, sk, tr

### 3. NAHRÃVÃNÃ NA GITHUB

**PRAVIDLO:** NahrÃ¡vat POUZE po testovÃ¡nÃ­ a schvÃ¡lenÃ­ uÅ¾ivatelem!

**Postup:**
1. UdÄ›lat zmÄ›ny pomocÃ­ nÃ¡strojÅ¯ Cursor
2. Informovat uÅ¾ivatele co bylo zmÄ›nÄ›no
3. POÄŒKAT na testovÃ¡nÃ­ uÅ¾ivatelem
4. POÄŒKAT na schvÃ¡lenÃ­ ("nahraj na GitHub")
5. Teprve pak: `git add -A`, `git commit`, `git push`

**Git pÅ™Ã­kazy (pÅ™es cmd):**
```bash
cmd /c "git status"
cmd /c "git add -A"
cmd /c "git commit -m \"popis zmÄ›n\""
cmd /c "git push origin main"
```

**POZOR:** Branch je `main`, NE `master`!

### 4. PÅ˜ED KAÅ½DOU ZMÄšNOU

**Pravidla:**
1. **Nastudovat kÃ³d** pÅ™ed editacÃ­ - pochopit jak funguje
2. **MalÃ© zmÄ›ny** - nedÄ›lat velkÃ© refaktoringy bez vyÅ¾Ã¡dÃ¡nÃ­
3. **Testovat lokÃ¡lnÄ›** - uÅ¾ivatel mÃ¡ Live Server na `http://127.0.0.1:5500`
4. **Konzistence** - pouÅ¾Ã­vat stejnÃ© vzory jako existujÃ­cÃ­ kÃ³d

### 5. ZÃLOHOVÃNÃ

**PÅ™ed velkÃ½mi zmÄ›nami vytvoÅ™it zÃ¡lohu:**
```bash
cmd /c "robocopy C:\Users\TOMLAP~1\Liquimixer C:\Users\TOMLAP~1\Liquimixer_backup_DATUM /E /XD node_modules .git"
```

**ZÃ¡lohy jsou v:** `C:\Users\TomÃ¡Å¡Lapos\Liquimixer_backup_*`

---

## ğŸ“ STRUKTURA PROJEKTU

### HlavnÃ­ soubory

| Soubor | Velikost | Popis |
|--------|----------|-------|
| `index.html` | ~123KB | HlavnÃ­ HTML, vÅ¡echny modÃ¡ly, struktura UI |
| `app.js` | ~230KB, ~6000 Å™Ã¡dkÅ¯ | VeÅ¡kerÃ¡ aplikaÄnÃ­ logika |
| `styles.css` | ~107KB | VeÅ¡kerÃ© CSS styly, animace |
| `i18n.js` | ~19KB | Internacionalizace, sprÃ¡va jazykÅ¯ |
| `database.js` | ~36KB | Supabase operace (CRUD) |
| `subscription.js` | ~21KB | PÅ™edplatnÃ©, platby, billing |
| `fcm.js` | ~8KB | Firebase Cloud Messaging |

### Jak je app.js organizovÃ¡n (~6000 Å™Ã¡dkÅ¯):

```
Å˜Ã¡dky 1-50:      BezpeÄnostnÃ­ funkce (escapeHtml, sanitizeUrl)
Å˜Ã¡dky 50-200:    flavorDatabase - typy pÅ™Ã­chutÃ­ a steeping Äasy
Å˜Ã¡dky 200-500:   Inicializace, autentizace (Clerk)
Å˜Ã¡dky 500-1000:  UI funkce (showPage, navigace, modÃ¡ly)
Å˜Ã¡dky 1000-1500: UklÃ¡dÃ¡nÃ­ receptÅ¯, produkty
Å˜Ã¡dky 1500-2000: Editace receptÅ¯, zobrazenÃ­ detailu
Å˜Ã¡dky 2000-3000: VÃ½poÄetnÃ­ funkce (calculateMix, calculateProMix)
Å˜Ã¡dky 3000-4000: Liquid PRO multi-flavor logika
Å˜Ã¡dky 4000-5000: VÃ½sledky, tabulky, zobrazenÃ­
Å˜Ã¡dky 5000-5500: PÅ™ipomÃ­nky zrÃ¡nÃ­ (reminders)
Å˜Ã¡dky 5500-6000: Kontakt, menu, pomocnÃ© funkce
Å˜Ã¡dky 6000+:     window.* exporty pro globÃ¡lnÃ­ pÅ™Ã­stup
```

### PÅ™eklady - DÅ®LEÅ½ITÃ‰

**UmÃ­stÄ›nÃ­:** `locales/` sloÅ¾ka

**ReferenÄnÃ­ soubor:** `locales/cs.json` - VÅ½DY porovnÃ¡vat s tÃ­mto!

**PouÅ¾itÃ­ v HTML:**
```html
<span data-i18n="section.key">Fallback text</span>
<input data-i18n-placeholder="section.key" placeholder="Fallback">
<button data-i18n-title="section.key" title="Fallback">
```

**PouÅ¾itÃ­ v JS:**
```javascript
const text = t('section.key', 'Fallback text');
// Po dynamickÃ©m renderovÃ¡nÃ­:
window.i18n.applyTranslations();
```

**HlavnÃ­ sekce v JSON:**
- `meta` - kÃ³d jazyka, nÃ¡zev
- `nav` - navigace (home, menu, account)
- `auth` - pÅ™ihlÃ¡Å¡enÃ­, profil
- `form` - formulÃ¡Å™ovÃ© popisky
- `results` - vÃ½sledky vÃ½poÄtu
- `save_recipe` - uklÃ¡dÃ¡nÃ­ receptu
- `reminder` - pÅ™ipomÃ­nky zrÃ¡nÃ­
- `recipe_detail` - detail receptu
- `common` - obecnÃ© (save, cancel, delete, day/days)

### Grafika a ikony
```
icons/
â”œâ”€â”€ icon-192.png      # PWA ikona malÃ¡
â”œâ”€â”€ icon-512.png      # PWA ikona velkÃ¡  
â”œâ”€â”€ icon.svg          # ZdrojovÃ© SVG
â”œâ”€â”€ og-image.png      # Open Graph (1200x630px) - POVINNÃ FORMÃT!
â””â”€â”€ og-image.svg      # ZdrojovÃ© SVG pro OG
```

### Supabase Backend

**Edge funkce:** `supabase/functions/`
- `billing/` - fakturace
- `contact/` - kontaktnÃ­ formulÃ¡Å™
- `geolocation/` - geolokace uÅ¾ivatele
- `gpwebpay/` - platebnÃ­ brÃ¡na
- `idoklad/` - iDoklad integrace
- `invoice/` - generovÃ¡nÃ­ faktur
- `refund/` - refundace
- `reminder-notify/` - notifikace pÅ™ipomÃ­nek (CRON)
- `subscription/` - kontrola pÅ™edplatnÃ©ho

**DatabÃ¡zovÃ© tabulky:**
- `recipes` - uloÅ¾enÃ© recepty
- `products` - oblÃ­benÃ© produkty
- `reminders` - pÅ™ipomÃ­nky zrÃ¡nÃ­
- `subscriptions` - pÅ™edplatnÃ©
- `user_settings` - nastavenÃ­ (jazyk, tÃ©ma)

---

## ğŸ¨ GRAFIKA A STYLING

### BarevnÃ© schÃ©ma (CSS promÄ›nnÃ© v styles.css)
```css
--neon-cyan: #00ffff;      /* PrimÃ¡rnÃ­ - tlaÄÃ­tka, odkazy */
--neon-pink: #ff00ff;      /* SekundÃ¡rnÃ­ - akcenty, login */
--neon-green: #00ff00;     /* Sekce "PÅ™ed mÃ­chÃ¡nÃ­m" */
--neon-purple: #bb86fc;    /* ÃšvodnÃ­ text, info boxy */
--bg-dark: #0a0a0a;        /* TmavÃ© pozadÃ­ */
--bg-card: #1a1a2e;        /* Karty, modÃ¡ly */
```

### TlaÄÃ­tka - typy a pouÅ¾itÃ­

| TÅ™Ã­da | PouÅ¾itÃ­ | Barva |
|-------|---------|-------|
| `.neon-button` | HlavnÃ­ akce (VypoÄÃ­tat, UloÅ¾it) | Cyan |
| `.neon-button.secondary` | SekundÃ¡rnÃ­ akce | Pink |
| `.neon-button.btn-green` | PotvrzenÃ­ | ZelenÃ¡ |
| `.neon-button.btn-red` | Smazat, ZruÅ¡it | ÄŒervenÃ¡ |
| `.mode-button.cyan` | eLiquid kalkulÃ¡tor | Cyan s pulzujÃ­cÃ­m textem |
| `.mode-button.pink` | Å˜edÄ›nÃ­ nikotinu | Pink s pulzujÃ­cÃ­m textem |
| `.nav-btn` | Navigace (DomÅ¯, Menu) | Cyan border |
| `.nav-btn.login-btn` | MÅ¯j ÃºÄet | Pink border a pulz |

### Animace

**PulzujÃ­cÃ­ text (mode-button):**
```css
@keyframes textGlowWave { /* v styles.css */ }
/* Aplikuje se na .mode-button .mode-title .char */
/* KaÅ¾dÃ½ znak mÃ¡ animation-delay pro vlnovÃ½ efekt */
```

**PulzujÃ­cÃ­ border (ostatnÃ­ tlaÄÃ­tka):**
```css
@keyframes border-pulse-sweep { /* v styles.css */ }
/* Aplikuje se pÅ™es ::after pseudo-element */
/* Gradient bÄ›Å¾Ã­ zleva doprava */
```

**DÅ®LEÅ½ITÃ‰:** Po zmÄ›nÄ› jazyka se musÃ­ znovu inicializovat animace textu:
```javascript
// V index.html je window.animateModeButtons()
// VolÃ¡ se pÅ™i DOMContentLoaded a localeChanged
```

### Sekce s orÃ¡movÃ¡nÃ­m

| TÅ™Ã­da | Obsah | Barva orÃ¡movÃ¡nÃ­ |
|-------|-------|-----------------|
| `.app-description-box` | ÃšvodnÃ­ popis aplikace | FialovÃ¡ (#bb86fc) |
| `.prep-box` | "PÅ™ed mÃ­chÃ¡nÃ­m si pÅ™ipravte" | Neon zelenÃ¡ |
| `.disclaimer-box` | UpozornÄ›nÃ­ | Å½lutÃ¡/oranÅ¾ovÃ¡ |
| `.results-container` | VÃ½sledky vÃ½poÄtu | Cyan gradient |

### ModÃ¡ly (v index.html)

| ID | ÃšÄel | OtevÃ­rÃ¡ funkce |
|----|------|----------------|
| `#saveRecipeModal` | NovÃ½ recept | `showSaveRecipeModal()` |
| `#editRecipeModal` | Ãšprava receptu | `showEditRecipeForm()` |
| `#addReminderModal` | NovÃ¡ pÅ™ipomÃ­nka | `showAddReminderModal(recipeId)` |
| `#editReminderModal` | Ãšprava pÅ™ipomÃ­nky | `showEditReminderModal(id, recipeId)` |
| `#userProfileModal` | UÅ¾ivatelskÃ½ profil | `showUserProfileModal()` |
| `#menuModal` | HlavnÃ­ menu | `showMenuModal()` |
| `#loginRequiredModal` | VÃ½zva k pÅ™ihlÃ¡Å¡enÃ­ | `showLoginRequiredModal()` |

### Tabulka vÃ½sledkÅ¯ (konzistentnÃ­ styling)

**DÅ®LEÅ½ITÃ‰:** PÅ™i zobrazenÃ­ receptu pouÅ¾Ã­t stejnÃ© tÅ™Ã­dy jako pÅ™i vÃ½poÄtu!

```html
<div class="results-table-container">
  <table class="results-table">
    <tr>
      <td class="ingredient-name">NÃ¡zev</td>
      <td class="ingredient-value">10.5 ml</td>
      <td class="ingredient-percent">21%</td>
      <td class="ingredient-drops">105</td>
    </tr>
  </table>
</div>
```

TÅ™Ã­dy definovÃ¡ny v `styles.css` sekce `/* Results table */`

---

## ğŸ”§ KLÃÄŒOVÃ‰ FUNKCE

### Kalkulace e-liquidu

```javascript
// ZÃ¡kladnÃ­ kalkulÃ¡tor (jedna pÅ™Ã­chuÅ¥)
calculateMix() 
// - ÄŒte hodnoty z formulÃ¡Å™e #mixerForm
// - VolÃ¡ displayResults(data, {formType: 'eliquid', flavorType: selectedFlavor})

// Shake & Vape (bez nikotinu, rychlÃ©)
calculateShakeVape()
// - FormulÃ¡Å™ #shakevapeForm
// - VolÃ¡ displayResults(data, {formType: 'shakevape', flavorType: 'fruit'})

// Liquid PRO (vÃ­ce pÅ™Ã­chutÃ­)
calculateProMix()
// - FormulÃ¡Å™ #proMixerForm
// - Podporuje aÅ¾ 5 pÅ™Ã­chutÃ­ s vlastnÃ­mi %
// - VolÃ¡ displayResults(data, {formType: 'liquidpro', flavors: flavorsData})
```

**DÅ®LEÅ½ITÃ‰ pro pÅ™ipomÃ­nky:** `displayResults` uklÃ¡dÃ¡ `flavorType` do `currentRecipeData` pro vÃ½poÄet steeping Äasu!

### ZobrazenÃ­ vÃ½sledkÅ¯

```javascript
displayResults(data, extraData)
// - data: { vg, pg, nic, flavor, total, drops, ... }
// - extraData: { formType, flavorType, flavors }
// - UklÃ¡dÃ¡ do window.currentRecipeData pro pozdÄ›jÅ¡Ã­ uloÅ¾enÃ­
// - Renderuje HTML do #resultsContent

refreshResultsTable()
// - VolÃ¡ se pÅ™i zmÄ›nÄ› jazyka (event localeChanged)
// - PÅ™erenderuje vÃ½sledky se sprÃ¡vnÃ½mi pÅ™eklady
```

### Recepty - uklÃ¡dÃ¡nÃ­ a zobrazenÃ­

```javascript
// OtevÅ™Ã­t modal pro NOVÃ recept
showSaveRecipeModal()
// - Resetuje formulÃ¡Å™
// - NastavÃ­ tlaÄÃ­tko na t('save_recipe.save_button')
// - Inicializuje pÅ™ipomÃ­nku (zaÅ¡krtnutou)

// OtevÅ™Ã­t modal pro ÃšPRAVU
showEditRecipeForm()
// - VyplnÃ­ formulÃ¡Å™ daty z currentViewingRecipe
// - ZmÄ›nÃ­ tlaÄÃ­tko na t('save_recipe.save_changes')
// - ZmÄ›nÃ­ nadpis na t('save_recipe.edit_title')

// UloÅ¾it recept do Supabase
saveRecipe()
// - Validuje formulÃ¡Å™
// - UklÃ¡dÃ¡ recipe_data vÄetnÄ› flavorType!
// - VolitelnÄ› vytvoÅ™Ã­ pÅ™ipomÃ­nku

// Zobrazit detail receptu
viewRecipeDetail(recipeId)
// - NaÄte recept z DB
// - NastavÃ­ window.currentViewingRecipe (DÅ®LEÅ½ITÃ‰!)
// - VolÃ¡ displayRecipeDetail()
// - Po renderovÃ¡nÃ­ volÃ¡ loadRecipeReminders()

// Renderovat HTML detailu
displayRecipeDetail(recipe, contentId)
// - contentId: 'recipeDetailContent' nebo 'favoriteRecipeDetailContent'
// - MUSÃ pouÅ¾Ã­t stejnÃ© CSS tÅ™Ã­dy jako displayResults()!
```

### PÅ™ipomÃ­nky zrÃ¡nÃ­ (reminders)

```javascript
// OtevÅ™Ã­t modal pro novou pÅ™ipomÃ­nku
showAddReminderModal(recipeId)
// - HledÃ¡ flavorType v recipe.recipe_data.flavorType
// - Fallback: hledÃ¡ v recipe.recipe_data.ingredients
// - NastavÃ­ currentReminderSteepingDays podle flavorDatabase

// Automaticky vypoÄÃ­tat datum pÅ™ipomÃ­nky
updateReminderDate()
// - Bere datum mÃ­chÃ¡nÃ­ z #reminderMixDate
// - PÅ™iÄte currentReminderSteepingDays
// - NastavÃ­ #reminderRemindDate

// NaÄÃ­st pÅ™ipomÃ­nky pro recept
loadRecipeReminders(recipeId, showAll = false)
// - Å˜adÃ­ od NEJNOVÄšJÅ ÃCH (nejvyÅ¡Å¡Ã­ remind_at nahoÅ™e)
// - Zobrazuje max 3, pak "Zobrazit vÅ¡echny"

// Renderovat jednu pÅ™ipomÃ­nku
renderReminderItem(reminder, recipeId)
// - PouÅ¾Ã­vÃ¡ t() pro pÅ™eklady
// - FormÃ¡tuje datum podle aktuÃ¡lnÃ­ho locale
```

### PÅ™eklady - i18n systÃ©m

```javascript
// ZÃ­skat pÅ™eklad
t(key, fallback)
// PÅ™Ã­klad: t('save_recipe.title', 'UloÅ¾it recept')

// Aplikovat pÅ™eklady na DOM elementy
window.i18n.applyTranslations()
// - HledÃ¡ [data-i18n], [data-i18n-placeholder], [data-i18n-title]
// - VOLAT PO KAÅ½DÃ‰M DYNAMICKÃ‰M RENDEROVÃNÃ!

// ZmÄ›nit jazyk
window.i18n.setLocale(localeCode)
// - NaÄte JSON soubor
// - UloÅ¾Ã­ preference do DB (pokud pÅ™ihlÃ¡Å¡en)
// - Dispatchne event 'localeChanged'

// Event pÅ™i zmÄ›nÄ› jazyka
window.addEventListener('localeChanged', () => {
    refreshResultsTable();      // PÅ™erenderovat vÃ½sledky
    refreshRecipeDetail();      // PÅ™erenderovat detail receptu
    window.animateModeButtons(); // Znovu animovat tlaÄÃ­tka
});
```

### DatabÃ¡ze pÅ™Ã­chutÃ­ (flavorDatabase)

```javascript
// DefinovÃ¡no na zaÄÃ¡tku app.js (~Å™Ã¡dky 50-170)
const flavorDatabase = [
    { value: 'none', name: 'Å½Ã¡dnÃ¡', steepingDays: 0 },
    { value: 'fruit', name: 'OvocnÃ¡', steepingDays: 3 },
    { value: 'citrus', name: 'CitrusovÃ¡', steepingDays: 3 },
    { value: 'menthol', name: 'MentolovÃ¡', steepingDays: 1 },
    { value: 'mint', name: 'MÃ¡tovÃ¡', steepingDays: 2 },
    { value: 'cream', name: 'KrÃ©movÃ¡', steepingDays: 7 },
    { value: 'custard', name: 'Pudink', steepingDays: 14 },
    { value: 'dessert', name: 'DezertnÃ­', steepingDays: 7 },
    { value: 'bakery', name: 'PeÄivo', steepingDays: 10 },
    { value: 'tobacco', name: 'TabÃ¡kovÃ¡', steepingDays: 21 },
    { value: 'beverage', name: 'NÃ¡pojovÃ¡', steepingDays: 5 },
    { value: 'candy', name: 'BonbÃ³novÃ¡', steepingDays: 4 },
    { value: 'nut', name: 'OÅ™Ã­Å¡kovÃ¡', steepingDays: 10 },
    { value: 'spice', name: 'KoÅ™enÄ›nÃ¡', steepingDays: 14 },
    { value: 'floral', name: 'KvÄ›tinovÃ¡', steepingDays: 7 }
];

// PÅ™i vÃ­ce pÅ™Ã­chutÃ­ch (Liquid PRO): pouÅ¾Ã­t NEJDELÅ Ã steeping Äas!
```

### GlobÃ¡lnÃ­ promÄ›nnÃ© (window.*)

```javascript
window.currentRecipeData     // AktuÃ¡lnÃ­ vypoÄÃ­tanÃ½ recept
window.currentViewingRecipe  // AktuÃ¡lnÄ› zobrazenÃ½ uloÅ¾enÃ½ recept
window.i18n                  // i18n objekt
window.LiquiMixerDB          // DatabÃ¡zovÃ© operace
window.Clerk                 // Autentizace

// ExportovanÃ© funkce (na konci app.js)
window.calculateMixture = calculateMix;
window.showSaveRecipeModal = showSaveRecipeModal;
window.viewRecipeDetail = viewRecipeDetail;
window.showAddReminderModal = showAddReminderModal;
// ... a dalÅ¡Ã­
```

---

## ğŸ“± PWA & NOTIFIKACE

- `manifest.json` - PWA manifest
- `sw.js` - Service Worker pro offline
- `firebase-messaging-sw.js` - Firebase Cloud Messaging
- `fcm.js` - FCM client-side logika

---

## ğŸš€ DEPLOYMENT

- Hosting: Zeabur (automatickÃ½ deploy z GitHub)
- Branch: `main`
- Konfigurace: `zeabur.json`

---

## ğŸ“ ÄŒASTÃ‰ PROBLÃ‰MY A Å˜EÅ ENÃ

### PÅ™eklady se nenaÄÃ­tajÃ­
1. Zkontrolovat JSON syntax v jazykovÃ©m souboru
2. Zkontrolovat zda klÃ­Ä existuje v danÃ©m souboru
3. Zkontrolovat zda se volÃ¡ `applyTranslations()` po zmÄ›nÄ› obsahu

### TlaÄÃ­tka/texty se nepÅ™eklÃ¡dajÃ­
1. Hardcoded text v JS â†’ zmÄ›nit na `t('key', 'fallback')`
2. ChybÄ›jÃ­cÃ­ `data-i18n` atribut v HTML
3. Dynamicky generovanÃ½ obsah â†’ volat `applyTranslations()` po renderovÃ¡nÃ­

### Grafika receptu se nezobrazuje
1. Zkontrolovat CSS tÅ™Ã­dy (`results-table-container`, `ingredient-name`, atd.)
2. Zkontrolovat zda se pouÅ¾Ã­vÃ¡ stejnÃ¡ struktura jako v `displayResults()`

### PÅ™ipomÃ­nky nefungujÃ­
1. `window.currentViewingRecipe` musÃ­ bÃ½t nastaveno
2. `flavorType` musÃ­ bÃ½t uloÅ¾eno v `recipe_data`
3. Pro starÅ¡Ã­ recepty fallback hledÃ¡ `flavorType` v `ingredients`

---

## ğŸ“… HISTORIE ZMÄšN A PROBLÃ‰MÅ®

### 9.1.2026 - GP WebPay integrace (TESTOVACÃ REÅ½IM)
**KompletnÃ­ implementace platebnÃ­ brÃ¡ny GP WebPay**

**INCIDENT (opraveno):**
- PÅ™idÃ¡nÃ­ sloÅ¾ky GPWebpay/ zpÅ¯sobilo deployment failure na Zeabur
- Å˜eÅ¡enÃ­: `git revert`, aktualizace `.gitignore`, novÃ¡ implementace bez binÃ¡rnÃ­ch souborÅ¯

**ImplementovÃ¡no:**
- âœ… RSA-SHA1 podepisovÃ¡nÃ­ pomocÃ­ node-forge
- âœ… TestovacÃ­ konfigurace (merchant: 123456, test gateway)
- âœ… OvÄ›Å™enÃ­ podpisu odpovÄ›di od GP WebPay
- âœ… Callback endpoint s pÅ™esmÄ›rovÃ¡nÃ­m uÅ¾ivatele
- âœ… AutomatickÃ¡ fakturace a export do iDoklad po platbÄ›
- âœ… Oprava typo `handleCorsPreflght` â†’ `handleCorsPreflight`
- âœ… Dokumentace GPWEBPAY_SETUP.md

**TestovacÃ­ karty:**
| Karta | VÃ½sledek |
|-------|----------|
| `4056070000000008` | âœ… ÃšspÄ›Å¡nÃ¡ |
| `4056070000000016` | âŒ ZamÃ­tnutÃ¡ |

**Supabase secrets (nastaveny):**
- `GPWEBPAY_TEST_MODE=true`
- `GPWEBPAY_PRIVATE_KEY` (Base64 testovacÃ­ klÃ­Ä)
- `GPWEBPAY_PRIVATE_KEY_PASSWORD=111111`
- `GPWEBPAY_GPE_PUBLIC_KEY` (Base64 veÅ™ejnÃ½ klÃ­Ä GPE)
- `APP_BASE_URL=https://www.liquimixer.com`
- SMTP konfigurace pro faktury

**Pro pÅ™echod do produkce:**
1. Nastavit `GPWEBPAY_TEST_MODE=false`
2. VymÄ›nit testovacÃ­ klÃ­Äe za produkÄnÃ­ od banky
3. Aktualizovat `GPWEBPAY_MERCHANT_NUMBER`
4. Deploy: `supabase functions deploy gpwebpay`

### 8.1.2026 - PÅ™eklady a tlaÄÃ­tka
- âœ… Opraveny pÅ™eklady tlaÄÃ­tek "UloÅ¾it zmÄ›ny" a "UloÅ¾it recept" (hardcoded â†’ t())
- âœ… PÅ™idÃ¡ny chybÄ›jÃ­cÃ­ klÃ­Äe do vÅ¡ech 31 jazykÅ¯ (reminder, recipe_detail, save_recipe)
- âœ… Opraveno Å™azenÃ­ pÅ™ipomÃ­nek (nejnovÄ›jÅ¡Ã­ nahoÅ™e)
- âœ… Opravena grafika sloÅ¾ek v uloÅ¾enÃ½ch receptech (results-table-container)

### 7.1.2026 - KRITICKÃ INCIDENT: Korupce app.js
**Co se stalo:**
- PowerShell pÅ™Ã­kazy poÅ¡kodily UTF-8 kÃ³dovÃ¡nÃ­ v app.js
- VÅ¡echny ÄeskÃ© znaky se zmÄ›nily na neÄitelnÃ© symboly
- Emoji ikony se rozpadly

**Jak se opravilo:**
- RuÄnÃ­ oprava stovek Å™Ã¡dkÅ¯ pomocÃ­ search_replace
- PorovnÃ¡vÃ¡nÃ­ s cs.json pro sprÃ¡vnÃ© ÄeskÃ© texty

**PouÄenÃ­:**
- NIKDY nepouÅ¡tÄ›t PowerShell pro editaci souborÅ¯!
- VÅ¾dy dÄ›lat zÃ¡lohu pÅ™ed velkÃ½mi zmÄ›nami

### 6-7.1.2026 - PÅ™ipomÃ­nky zrÃ¡nÃ­
- âœ… Implementace systÃ©mu pÅ™ipomÃ­nek (reminders)
- âœ… AutomatickÃ½ vÃ½poÄet steeping Äasu podle typu pÅ™Ã­chutÄ›
- âœ… Edge funkce reminder-notify pro notifikace
- âœ… Oprava vÃ½poÄtu pro starÅ¡Ã­ recepty (fallback hledÃ¡nÃ­ flavorType)

### 5.1.2026 - PulzujÃ­cÃ­ animace
- âœ… PulzujÃ­cÃ­ text pro mode-button (eLiquid, Å˜edÄ›nÃ­ nikotinu)
- âœ… PulzujÃ­cÃ­ border pro ostatnÃ­ tlaÄÃ­tka
- âœ… Oprava barvy pulzovÃ¡nÃ­ pro rÅ¯Å¾ovÃ© tlaÄÃ­tko "MÅ¯j ÃºÄet"

---

## ğŸ› ZNÃMÃ‰ PROBLÃ‰MY

### LokÃ¡lnÃ­ vÃ½voj
- `Error checking subscription: SyntaxError` - NORMÃLNÃ na localhost
  - Supabase edge funkce nejsou dostupnÃ© lokÃ¡lnÄ›
  - Na produkci (Zeabur) funguje sprÃ¡vnÄ›

### PowerShell cesty
- Cesta s ÄeskÃ½mi znaky nefunguje v PowerShell
- PouÅ¾Ã­t krÃ¡tkou cestu: `C:\Users\TOMLAP~1\Liquimixer`

---

## ğŸ”— UÅ½ITEÄŒNÃ‰ ODKAZY

- **Produkce:** https://liquimixer.zeabur.app
- **GitHub:** https://github.com/tomaslapos/liquimixer
- **Supabase:** https://supabase.com/dashboard (projekt Liquimixer)
- **Clerk:** https://dashboard.clerk.com (autentizace)
- **Zeabur:** https://zeabur.com (hosting, auto-deploy z main branch)
