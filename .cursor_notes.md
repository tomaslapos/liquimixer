# LiquiMixer - PoznÃ¡mky pro AI asistenta

## ğŸ“‘ OBSAH (RYCHLÃ NAVIGACE)

| Sekce | Popis | DÅ¯leÅ¾itost |
|-------|-------|------------|
| [âš ï¸ KRITICKÃ PRAVIDLA](#ï¸-kritickÃ¡-pravidla---pÅ™eÄti-pÅ™ed-kaÅ¾dou-pracÃ­) | PowerShell, pÅ™eklady, Git, checklist | ğŸ”´ POVINNÃ‰ |
| [ğŸ“ STRUKTURA PROJEKTU](#-struktura-projektu) | Soubory, organizace app.js, pÅ™eklady | ğŸŸ¡ DÅ¯leÅ¾itÃ© |
| [ğŸ”§ KLÃÄŒOVÃ‰ FUNKCE](#-klÃ­ÄovÃ©-funkce) | Kalkulace, recepty, pÅ™ipomÃ­nky, i18n | ğŸŸ¡ DÅ¯leÅ¾itÃ© |
| [ğŸ“„ iDoklad API](#-idoklad-api-integrace) | DPH, mÄ›ny, VatRateType, faktury | ğŸŸ¢ Reference |
| [ğŸŒ JAZYK vs GEOLOKACE](#-jazyk-vs-geolokace---dvÄ›-nezÃ¡vislÃ©-funkce) | Locale vs Country, DPH logika | ğŸŸ¢ Reference |
| [ğŸ”§ SUPABASE CLI](#-supabase-cli) | PÅ™Ã­kazy, migrace, deploy | ğŸŸ¢ Reference |
| [ğŸ“‹ AKTUÃLNÃ ÃšKOLY](#-aktuÃ¡lnÃ­-Ãºkoly) | Co je k Å™eÅ¡enÃ­ | ğŸŸ¡ DÅ¯leÅ¾itÃ© |
| [ğŸŒŸ PLÃNOVANÃ‰ FUNKCE](#-plÃ¡novanÃ©-funkce) | DatabÃ¡ze pÅ™Ã­chutÃ­, produkty | ğŸŸ¢ Info |

---

## âš ï¸ KRITICKÃ PRAVIDLA - PÅ˜EÄŒTI PÅ˜ED KAÅ½DOU PRACÃ!

### 1. NIKDY NEPOUÅ TÄšT POWERSHELL PRO EDITACI SOUBORÅ®!

**ProÄ:**
- PowerShell na Windows mÃ¡ fatÃ¡lnÃ­ problÃ©my s UTF-8 kÃ³dovÃ¡nÃ­m
- Cesta `C:\Users\TomÃ¡Å¡Lapos` se rozpadne na `C:\Users\Tomï¿½ï¿½ï¿½Lapos`
- ÄŒeskÃ© znaky se zniÄÃ­: `Å½Ã¡dnÃ¡` â†’ `â”¼Å»â”œÃ­dnâ”œÃ­`, `pÅ™Ã­chuÅ¥` â†’ `pâ”¼Ã–â”œÅŸchuâ”¼Ä…`
- Emoji se rozpadnou: `ğŸ‘¤` â†’ `Â­ÄÄ¹Ä„`, `â˜…` â†’ `Ã”Å›Å¯`, `ğŸ—‘ï¸` â†’ `Ã”Å¥Ä½`

**Jak sprÃ¡vnÄ›:**
- Pro editaci souborÅ¯: VÃHRADNÄš nÃ¡stroje Cursor (`search_replace`, `write`, `read_file`)
- Pro Git operace: `cmd /c "git add -A && git commit -m 'message' && git push"`
- KrÃ¡tkÃ¡ cesta uÅ¾ivatele: `C:\Users\TOMLAP~1\Liquimixer`

**ZAKÃZANÃ‰ pÅ™Ã­kazy:**
```
âŒ Set-Content, Add-Content, Out-File
âŒ [System.IO.File]::WriteAllText()
âŒ (Get-Content file) -replace
âŒ jakÃ½koliv PowerShell pÅ™Ã­kaz co zapisuje do souboru
```

### 2. PÅ˜EKLADY NEDÄšLAT SKRIPTEM!

**ProÄ:**
- AutomatickÃ© skripty (generate-locales.js, complete-translations.js) NEFUNGUJÃ
- GenerujÃ­ neplatnÃ½ JSON nebo chybnÃ© pÅ™eklady

**Jak sprÃ¡vnÄ› pÅ™idÃ¡vat pÅ™eklady:**
1. **ReferenÄnÃ­ soubor:** `locales/cs.json` - VÅ½DY porovnÃ¡vat s tÃ­mto
2. OtevÅ™Ã­t JEDEN jazykovÃ½ soubor, pÅ™idat klÃ­Ä, opakovat pro dalÅ¡Ã­ jazyky POSTUPNÄš
3. Po kaÅ¾dÃ© ÃºpravÄ› ovÄ›Å™it validitu JSON

**31 podporovanÃ½ch jazykÅ¯:**
cs, en, de, fr, es, it, pl, ru, pt, nl, ja, ko, zh-CN, zh-TW, ar-SA, 
sv, da, fi, no, hr, sr, bg, ro, lt, lv, et, hu, el, uk, sk, tr

### 3. NAHRÃVÃNÃ NA GITHUB

**PRAVIDLO:** NahrÃ¡vat POUZE po testovÃ¡nÃ­ a schvÃ¡lenÃ­ uÅ¾ivatelem!

**Git pÅ™Ã­kazy (pÅ™es cmd):**
```bash
cmd /c "cd C:\Users\TOMLAP~1\Liquimixer && git status"
cmd /c "cd C:\Users\TOMLAP~1\Liquimixer && git add -A"
cmd /c "cd C:\Users\TOMLAP~1\Liquimixer && git commit -m popis-zmeny"
cmd /c "cd C:\Users\TOMLAP~1\Liquimixer && git push origin main"
```

**POZOR:** Branch je `main`, NE `master`!
**POZOR:** Commit message BEZ mezer a speciÃ¡lnÃ­ch znakÅ¯ (napÅ™. `fix-idoklad-jwt`)

### 4. PÅ˜ED KAÅ½DOU ZMÄšNOU

**âœ… CHECKLIST PÅ˜ED ZMÄšNOU V APP.JS:**
```
[ ] 1. Grep na nÃ¡zev funkce - existuje uÅ¾ jinde v souboru?
[ ] 2. PÅ™eÄÃ­st 50 Å™Ã¡dkÅ¯ PÅ˜ED a PO mÃ­stÄ› zmÄ›ny (kontext)
[ ] 3. Zkontrolovat, Å¾e nemÄ›nÃ­m funkÄnÃ­ kÃ³d (jen to potÅ™ebnÃ©)
[ ] 4. ZmÄ›na je MINIMÃLNÃ - jen to co je opravdu nutnÃ©
[ ] 5. Po zmÄ›nÄ›: ReadLints pro kontrolu syntaktickÃ½ch chyb
[ ] 6. NepouÅ¾Ã­vat PowerShell pro editaci!
```

### 5. ğŸš« KRITICKÃ‰ FUNKCE - NIKDY NEMÄšNIT BEZ KONZULTACE

| Funkce | Soubor | ProÄ je kritickÃ¡ |
|--------|--------|------------------|
| `calculateMix()` | app.js | HlavnÃ­ vÃ½poÄet Liquid |
| `calculateProMix()` | app.js | HlavnÃ­ vÃ½poÄet Liquid PRO |
| `calculateShishaMix()` | app.js | HlavnÃ­ vÃ½poÄet Shisha |
| `displayResults()` | app.js | ZobrazenÃ­ vÃ½sledkÅ¯ VÅ ECH formulÃ¡Å™Å¯ |
| `displayRecipeDetail()` | app.js | ZobrazenÃ­ detailu receptu |
| `saveRecipe()` | app.js | UklÃ¡dÃ¡nÃ­ do DB, validace |
| `getIngredientName()` | app.js | PÅ™eklad ingrediencÃ­ |
| `saveUserRecipe()` | database.js | Supabase uklÃ¡dÃ¡nÃ­ receptu |
| `getPublicRecipes()` | database.js | VeÅ™ejnÃ¡ databÃ¡ze receptÅ¯ |

### 6. ğŸ”¬ PRAVIDLA PRO VERIFIKACI PÅ˜ÃCHUTÃ A JEJICH PROCENT

**KRITICKÃ‰ PRAVIDLO: Å½Ã¡dnÃ© odhadovanÃ© hodnoty! StojÃ­ na tom zdravÃ­ lidÃ­ a dobrÃ© jmÃ©no aplikace.**

**Hierarchie zdrojÅ¯ (od nejspolehlivÄ›jÅ¡Ã­ch):**

| Priorita | Zdroj | PÅ™Ã­klad | Akce |
|----------|-------|---------|------|
| 1ï¸âƒ£ | **OficiÃ¡lnÃ­ dokumentace vÃ½robce** | Wonder Flavours Average-Usage.pdf, HiLIQ blog tutorial | âœ… PouÅ¾Ã­t oficiÃ¡lnÃ­ hodnoty |
| 2ï¸âƒ£ | **OficiÃ¡lnÃ­ blanket statement** | "VÅ¡echny naÅ¡e pÅ™Ã­chutÄ› 10%" (napÅ™. Big Mouth, K-Boom) | âœ… PouÅ¾Ã­t po ovÄ›Å™enÃ­ z webu vÃ½robce |
| 3ï¸âƒ£ | **SilnÃ½ komunitnÃ­ konsensus** | ATF 20k+ recipes, diy-vape-recipes statistiky | âœ… PouÅ¾Ã­t avg, min_typical, max_typical |
| 4ï¸âƒ£ | **SlabÃ½ komunitnÃ­ konsensus** | StarÃ© ECF thready, jednotlivÃ© posty | âš ï¸ ZvÃ¡Å¾it, nebo NULL |
| 5ï¸âƒ£ | **Å½Ã¡dnÃ¡ data** | NovÃ½ vÃ½robce, ukonÄenÃ¡ znaÄka | âŒ NULL - app upozornÃ­ uÅ¾ivatele |

**KonkrÃ©tnÃ­ postup verifikace:**

```
1. KONTROLA OFICIÃLNÃCH STRÃNEK VÃROBCE
   - FAQ sekce
   - ProduktovÃ© strÃ¡nky
   - PDF dokumenty (usage guides, mixing guides)
   
2. VYHLEDÃNÃ KOMUNITNÃHO KONSENSU
   - alltheflavors.com/flavors/[znaÄka]-[pÅ™Ã­chuÅ¥]
     â†’ "Average Usage", "Recommended Usage" z tisÃ­cÅ¯ receptÅ¯
   - diy-vape-recipes.com/flavors/[pÅ™Ã­chuÅ¥]_by_[znaÄka]
     â†’ Statistiky: min_used, avg_used, max_used, typical_range
   
3. DOPLÅ‡KOVÃ‰ ZDROJE (jen pro cross-check)
   - e-cigarette-forum.com thready
   - vapingunderground.com
   - reddit.com/r/DIY_eJuice
   
4. ROZHODNUTÃ
   - OficiÃ¡lnÃ­ + konsensus shodnÃ½ â†’ PouÅ¾Ã­t
   - Pouze silnÃ½ konsensus (20k+ receptÅ¯) â†’ PouÅ¾Ã­t
   - Pouze slabÃ½ konsensus â†’ NULL + pÅ™idat pÅ™Ã­chuÅ¥ bez %
   - Å½Ã¡dnÃ¡ data â†’ NULL
```

**ZnaÄky s ovÄ›Å™enÃ½mi oficiÃ¡lnÃ­mi daty:**

| ZnaÄka | Zdroj | Typ dat |
|--------|-------|---------|
| Wonder Flavours | diy.wf/Docs/Average-Usage.pdf | IndividuÃ¡lnÃ­ % pro kaÅ¾dou pÅ™Ã­chuÅ¥ |
| HiLIQ | blog.hiliq.com tutorial | ObecnÃ© 6-15% (low/med/high) |
| Flavorah | flavorah.com/about/faqs | ObecnÃ© 0.1-4%, nÄ›kterÃ© <0.5% |
| Purilum | ProduktovÃ© strÃ¡nky | ObecnÃ© 5-10% |
| VDLV | OficiÃ¡lnÃ­ web | Blanket 15% pro vÅ¡echny |
| 814 | OficiÃ¡lnÃ­ web | Blanket 20% pro vÅ¡echny |
| Big Mouth | OficiÃ¡lnÃ­ web | Blanket 10% pro vÅ¡echny |
| K-Boom | OficiÃ¡lnÃ­ web | Blanket 10% pro vÅ¡echny |

**ZnaÄky s komunitnÃ­m konsensem (ATF/ELR):**

| ZnaÄka | PoÄet receptÅ¯ | Spolehlivost |
|--------|---------------|--------------|
| Capella | 26k+ per flavor | âœ… VysokÃ¡ |
| TFA/TPA | 22k+ per flavor | âœ… VysokÃ¡ |
| FlavourArt | 15k+ per flavor | âœ… VysokÃ¡ |
| Flavor West | 5k+ per flavor | âœ… StÅ™ednÃ­-vysokÃ¡ |
| Inawera | 10k+ per flavor | âœ… VysokÃ¡ |

**ZnaÄky nastavenÃ© na NULL (nedostatek dat):**

| ZnaÄka | DÅ¯vod |
|--------|-------|
| LorAnn Oils | ExplicitnÄ› nepodporujÃ­ vaping |
| Smoking Bull | Å½Ã¡dnÃ¡ data, moÅ¾nÃ¡ ukonÄenÃ¡ Äinnost |
| Vapors Line | Å½Ã¡dnÃ¡ oficiÃ¡lnÃ­ data |
| Dampf Basis | Å½Ã¡dnÃ¡ oficiÃ¡lnÃ­ data |
| Molinberry | ZnaÄka ukonÄena 31.5.2023 (SMAZAT) |
| Hangsen | Å½Ã¡dnÃ¡ oficiÃ¡lnÃ­ dokumentace |

**URL pro rychlou verifikaci:**

```
ATF:     https://alltheflavors.com/flavors/[vendor]-[flavor-name]
DVR:     https://www.diy-vape-recipes.com/flavors/[flavor-name]_by_[vendor]
ELR:     https://e-liquid-recipes.com/flavor/[id]/[name]
WF-docs: https://diy.wf/Docs/
```

### 7. âœ… FUNKCE KTERÃ‰ FUNGUJÃ - NETESTOVAT ZNOVU

- [x] Liquid kalkulace (`calculateMix`)
- [x] Liquid PRO multi-flavor (`calculateProMix`)
- [x] Shisha separÃ¡tnÃ­ VG/PG (`calculateShishaMix`)
- [x] HodnocenÃ­ receptÅ¯ (`submitRating`)
- [x] Sklad produktÅ¯ - tlaÄÃ­tka +/- (`updateProductStockUI`)
- [x] PÅ™ipomÃ­nky zrÃ¡nÃ­ (`loadRecipeReminders`)
- [x] Navigace mezi formulÃ¡Å™i (`goBackToCalculator`)

### 7. ZÃLOHOVÃNÃ

```bash
cmd /c "robocopy C:\Users\TOMLAP~1\Liquimixer C:\Users\TOMLAP~1\Liquimixer_backup_DATUM /E /XD node_modules .git"
```

---

## ğŸ“ STRUKTURA PROJEKTU

### HlavnÃ­ soubory

| Soubor | Velikost | Popis |
|--------|----------|-------|
| `index.html` | ~123KB | HlavnÃ­ HTML, vÅ¡echny modÃ¡ly, struktura UI |
| `app.js` | ~230KB, ~6000 Å™Ã¡dkÅ¯ | VeÅ¡kerÃ¡ aplikaÄnÃ­ logika |
| `styles.css` | ~107KB | VeÅ¡kerÃ© CSS styly, animace |
| `i18n.js` | ~19KB | Internacionalizace, sprÃ¡va jazykÅ¯ |
| `database.js` | ~36KB | Supabase operace (CRUD) |
| `subscription.js` | ~21KB | PÅ™edplatnÃ©, platby, billing |
| `fcm.js` | ~8KB | Firebase Cloud Messaging |

### Jak je app.js organizovÃ¡n (~6000 Å™Ã¡dkÅ¯):

```
Å˜Ã¡dky 1-50:      BezpeÄnostnÃ­ funkce (escapeHtml, sanitizeUrl)
Å˜Ã¡dky 50-200:    flavorDatabase - typy pÅ™Ã­chutÃ­ a steeping Äasy
Å˜Ã¡dky 200-500:   Inicializace, autentizace (Clerk)
Å˜Ã¡dky 500-1000:  UI funkce (showPage, navigace, modÃ¡ly)
Å˜Ã¡dky 1000-1500: UklÃ¡dÃ¡nÃ­ receptÅ¯, produkty
Å˜Ã¡dky 1500-2000: Editace receptÅ¯, zobrazenÃ­ detailu
Å˜Ã¡dky 2000-3000: VÃ½poÄetnÃ­ funkce (calculateMix, calculateProMix)
Å˜Ã¡dky 3000-4000: Liquid PRO multi-flavor logika
Å˜Ã¡dky 4000-5000: VÃ½sledky, tabulky, zobrazenÃ­
Å˜Ã¡dky 5000-5500: PÅ™ipomÃ­nky zrÃ¡nÃ­ (reminders)
Å˜Ã¡dky 5500-6000: Kontakt, menu, pomocnÃ© funkce
Å˜Ã¡dky 6000+:     window.* exporty pro globÃ¡lnÃ­ pÅ™Ã­stup
```

### PÅ™eklady - DÅ®LEÅ½ITÃ‰

**UmÃ­stÄ›nÃ­:** `locales/` sloÅ¾ka

**ReferenÄnÃ­ soubor:** `locales/cs.json` - VÅ½DY porovnÃ¡vat s tÃ­mto!

**PouÅ¾itÃ­ v HTML:**
```html
<span data-i18n="section.key">Fallback text</span>
<input data-i18n-placeholder="section.key" placeholder="Fallback">
```

**PouÅ¾itÃ­ v JS:**
```javascript
const text = t('section.key', 'Fallback text');
// Po dynamickÃ©m renderovÃ¡nÃ­:
window.i18n.applyTranslations();
```

### Supabase Backend

**Edge funkce:** `supabase/functions/`

| Funkce | ÃšÄel | verify_jwt |
|--------|------|------------|
| `billing/` | Fakturace | true |
| `contact/` | KontaktnÃ­ formulÃ¡Å™ | true |
| `geolocation/` | Geolokace uÅ¾ivatele | true |
| `gpwebpay/` | PlatebnÃ­ brÃ¡na callback | **false** |
| `idoklad/` | iDoklad integrace | **false** |
| `invoice/` | GenerovÃ¡nÃ­ faktur | **false** |
| `subscription/` | PÅ™edplatnÃ© | true |
| `reminder-notify/` | Notifikace (CRON) | true |
| `user-cleanup/` | MazÃ¡nÃ­ ÃºÄtÅ¯ (CRON) | true |

**DatabÃ¡zovÃ© tabulky:**

| Tabulka | ÃšÄel |
|---------|------|
| `recipes` | UloÅ¾enÃ© recepty (id, clerk_id, name, recipe_data, is_public) |
| `products` | OblÃ­benÃ© produkty |
| `reminders` | PÅ™ipomÃ­nky zrÃ¡nÃ­ |
| `subscriptions` | PÅ™edplatnÃ© (status, expires_at, user_country) |
| `invoices` | Faktury |
| `payments` | Platby |
| `users` | UÅ¾ivatelÃ© |
| `recipe_ratings` | HodnocenÃ­ receptÅ¯ |

---

## ğŸ”§ KLÃÄŒOVÃ‰ FUNKCE

### Kalkulace e-liquidu

```javascript
calculateMix()      // ZÃ¡kladnÃ­ kalkulÃ¡tor (jedna pÅ™Ã­chuÅ¥)
calculateShakeVape() // Shake & Vape (bez nikotinu)
calculateProMix()   // Liquid PRO (vÃ­ce pÅ™Ã­chutÃ­)
calculateShishaMix() // Shisha kalkulÃ¡tor
```

### ZobrazenÃ­ vÃ½sledkÅ¯

```javascript
displayResults(data, extraData)
// - data: { vg, pg, nic, flavor, total, drops, ... }
// - extraData: { formType, flavorType, flavors }
// - UklÃ¡dÃ¡ do window.currentRecipeData
```

### Recepty

```javascript
showSaveRecipeModal()     // Modal pro NOVÃ recept
showEditRecipeForm()      // Modal pro ÃšPRAVU
saveRecipe()              // UloÅ¾it do Supabase
viewRecipeDetail(recipeId) // Zobrazit detail
displayRecipeDetail()     // Renderovat HTML
```

### PÅ™ipomÃ­nky zrÃ¡nÃ­

```javascript
showAddReminderModal(recipeId)  // NovÃ¡ pÅ™ipomÃ­nka
loadRecipeReminders(recipeId)   // NaÄÃ­st pÅ™ipomÃ­nky
renderReminderItem(reminder)    // Renderovat poloÅ¾ku
```

### i18n systÃ©m

```javascript
t(key, fallback)                    // ZÃ­skat pÅ™eklad
window.i18n.applyTranslations()     // Aplikovat na DOM
window.i18n.setLocale(localeCode)   // ZmÄ›nit jazyk

// Event pÅ™i zmÄ›nÄ› jazyka
window.addEventListener('localeChanged', () => {
    refreshResultsTable();
    refreshRecipeDetail();
});
```

### GlobÃ¡lnÃ­ promÄ›nnÃ©

```javascript
window.currentRecipeData     // AktuÃ¡lnÃ­ vypoÄÃ­tanÃ½ recept
window.currentViewingRecipe  // AktuÃ¡lnÄ› zobrazenÃ½ uloÅ¾enÃ½ recept
window.i18n                  // i18n objekt
window.LiquiMixerDB          // DatabÃ¡zovÃ© operace
window.Clerk                 // Autentizace
```

---

## ğŸŒ JAZYK vs. GEOLOKACE - DVÄš NEZÃVISLÃ‰ FUNKCE!

| Funkce | ÃšÄel | Jak se urÄuje | Kde se pouÅ¾Ã­vÃ¡ |
|--------|------|---------------|----------------|
| **Jazyk (locale)** | Komunikace s uÅ¾ivatelem | ProhlÃ­Å¾eÄ nebo volba uÅ¾ivatele | UI, emaily |
| **Geolokace (country)** | MÃ­sto plnÄ›nÃ­ pro DPH | IP adresa uÅ¾ivatele | Cena, mÄ›na, DPH, iDoklad |

### DPH logika

| ZemÄ› | DPH | iDoklad kontakt | Cena |
|------|-----|-----------------|------|
| CZ | 21% | CZ | 59 CZK |
| EU zemÄ› | 21% | CZ (OSS reÅ¾im) | 2.40 EUR |
| Mimo EU | 0% | SkuteÄnÃ¡ zemÄ› | 2.90 USD |

---

## ğŸ“„ iDoklad API INTEGRACE

### Autentizace
- OAuth 2.0 Client Credentials flow
- Token URL: `https://identity.idoklad.cz/server/connect/token`
- API URL: `https://api.idoklad.cz/v3`

### KlÃ­ÄovÃ© hodnoty

| Parametr | Hodnota | Popis |
|----------|---------|-------|
| `VatRateType: 0` | Basic | 21% DPH (EU) |
| `VatRateType: 3` | Zero | 0% DPH (mimo EU) |
| `VatRateId: 747` | - | 21% pro CZ |
| `VatRateId: 749` | - | 0% |
| `CountryId: 1` | SK | Slovensko |
| `CountryId: 2` | CZ | ÄŒeskÃ¡ republika |
| `CurrencyId: 1` | CZK | - |
| `CurrencyId: 2` | EUR | - |
| `CurrencyId: 11` | USD | POZOR: ne 3! |
| `PriceType: 0` | - | Cena BEZ DPH |

### SprÃ¡vnÃ½ zpÅ¯sob posÃ­lÃ¡nÃ­ faktury

```typescript
  Items: [{
  Name: itemName,
    Amount: 1,
    Unit: 'ks',
  UnitPrice: unitPriceWithoutVat, // 48.76 (59/1.21 pro EU)
  VatRateType: 0, // nebo 3 pro mimo EU
  PriceType: 0, // Cena BEZ DPH
}]

// Pro cizÃ­ mÄ›ny pÅ™idat kurz:
ExchangeRate: 25.0, // Kurz z ÄŒNB
ExchangeRateAmount: 1,
```

### PouÄenÃ­ z Å™eÅ¡enÃ­ problÃ©mÅ¯

1. **NEPOUÅ½ÃVAT VatRate a VatRateType souÄasnÄ›** - zpÅ¯sobuje konflikt
2. **iDoklad bere DPH ze zemÄ› kontaktu** - pro EU nastavit kontakt na CZ
3. **NEAKTUALIZOVAT existujÃ­cÃ­ kontakt** - API to nedÄ›lÃ¡ spolehlivÄ›, radÄ›ji vytvoÅ™it novÃ½
4. **Email subject vÅ¾dy anglicky** - nÄ›kterÃ© SMTP servery majÃ­ problÃ©my s UTF-8

---

## ğŸ”§ SUPABASE CLI

### PÅ™Ã­kazy

```bash
# Verze a pÅ™ihlÃ¡Å¡enÃ­
npx supabase --version
npx supabase projects list

# Deploy edge funkcÃ­
npx supabase functions deploy --project-ref krwdfxnvhnxtkhtkbadi

# KonkrÃ©tnÃ­ funkce
npx supabase functions deploy idoklad --project-ref krwdfxnvhnxtkhtkbadi

# Migrace
npx supabase db push
npx supabase db push --include-all  # Pokud jsou lokÃ¡lnÃ­ migrace pÅ™ed vzdÃ¡lenÃ½mi

# Oprava historie migracÃ­
npx supabase migration repair --status applied 20260204
```

**Project reference:** `krwdfxnvhnxtkhtkbadi`

**POZOR:** Pokud migrace selÅ¾e, spustit SQL pÅ™Ã­mo v Supabase Dashboard SQL Editor

---

## ğŸ”— UÅ½ITEÄŒNÃ‰ ODKAZY

- **Produkce:** https://liquimixer.zeabur.app / https://www.liquimixer.com
- **GitHub:** https://github.com/tomaslapos/liquimixer
- **Supabase:** https://supabase.com/dashboard (projekt Liquimixer)
- **Clerk:** https://dashboard.clerk.com (autentizace)
- **Zeabur:** https://zeabur.com (hosting)

---

## ğŸ“ ZÃLOHY

| Datum | SloÅ¾ka | Obsah |
|-------|--------|-------|
| 2026-01-27 | `backup_2026-01-27/` | TikTok OAuth, rozhodovacÃ­ modal, terms_accepted_at |
| 2026-02-05 | `backup_2026-02-05/` | RannÃ­ - po opravÃ¡ch hodnocenÃ­ a Shisha |
| 2026-02-05 | `backup_2026-02-05-evening/` | VeÄernÃ­ - difficulty level, seed recepty |
| 2026-02-09 | `backup_2026-02-09/` | DatabÃ¡ze pÅ™Ã­chutÃ­, autocomplete, propojenÃ­ s recepty |
| 2026-02-10 | `backup_2026-02-10/` | Oprava VG/PG vÃ½poÄtu s konkrÃ©tnÃ­mi pÅ™Ã­chutÄ›mi, fulltext search |
| 2026-02-11 | `backup_2026-02-11/` | KompletnÃ­ synchronizace vÅ¡ech 31 locale souborÅ¯ (903 klÃ­ÄÅ¯) |
| 2026-02-12 | `backup_2026-02-12/` | Oprava VG/PG limitÅ¯ a doladÄ›nÃ­ pro premixed bÃ¡ze |

---

## Kontakty a secrets

### Supabase Secrets
- `GPWEBPAY_MERCHANT_NUMBER`, `GPWEBPAY_PRIVATE_KEY`, `GPWEBPAY_GPE_PUBLIC_KEY`
- `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD`
- `IDOKLAD_CLIENT_ID`, `IDOKLAD_CLIENT_SECRET`
- `CLERK_SECRET_KEY`

---

## ğŸ“‹ AKTUÃLNÃ ÃšKOLY

### Priorita VYSOKÃ

1. **ZobrazenÃ­ napojenÃ½ch produktÅ¯ v uloÅ¾enÃ©m receptu**
   - Detail receptu nezobrazuje sekci "PouÅ¾itÃ© produkty"
   - Funkce: `displayRecipeDetail()`, `getLinkedProducts()`

### Priorita STÅ˜EDNÃ

2. **Seed receptÅ¯ do veÅ™ejnÃ© databÃ¡ze**
   - AktuÃ¡lnÄ› pouze 35 receptÅ¯, cÃ­l 230
   - Skript: `supabase/scripts/fix_public_recipes.sql`

3. **ManuÃ¡l/NÃ¡povÄ›da pro PRO uÅ¾ivatele**

### ÄŒekajÃ­cÃ­ na schvÃ¡lenÃ­

- **Apple Developer Program** - Enrollment ID: 2D2P4U5VJU
  - Support Case ID: **20000110972896** (podÃ¡no 10.02.2026)
  - OÄekÃ¡vanÃ¡ odpovÄ›Ä: do 2 pracovnÃ­ch dnÅ¯

### âœ… VYÅ˜EÅ ENO (10.02.2026)

- ~~RLS policy pro `recipe_flavors`~~ - ProblÃ©m nebyl v RLS, ale v chybÄ›jÃ­cÃ­m `share_url` v `saveFlavorToFavorites()`
- ~~PoÄÃ¡teÄnÃ­ barva flavor slideru~~ - Opraveno pÅ™Ã­mÃ½m nastavenÃ­m barvy v `showFlavorSliderWithRange()`
- ~~PÅ™Ã­chutÄ› se neuklÃ¡dajÃ­ do oblÃ­benÃ½ch~~ - Opraveno pÅ™idÃ¡nÃ­m `share_url`
- ~~PÅ™eklady ingredientÅ¯~~ - PÅ™idÃ¡ny case pro `sweetener` a `shortfill_base` v `getIngredientName()`

---

## ğŸ“Š BUSINESS ANALÃZA - ÃšNOR 2026

### HOTOVÃ‰ FUNKCE V APLIKACI (aktualizovÃ¡no 11.02.2026)

| Kategorie | Funkce | Status |
|-----------|--------|--------|
| **KalkulÃ¡tory** | Liquid, Liquid PRO, S&V, Shisha, Dilute | âœ… |
| **Recepty** | UklÃ¡dÃ¡nÃ­, sdÃ­lenÃ­, veÅ™ejnÃ¡ DB, hodnocenÃ­, obtÃ­Å¾nost | âœ… |
| **PÅ™ipomÃ­nky** | ZrÃ¡nÃ­ liquidÅ¯, push notifikace, stock tracking | âœ… |
| **Produkty** | OblÃ­benÃ©, sklad, napojenÃ­ na recepty | âœ… |
| **PÅ™Ã­chutÄ›** | **3866 koncentrÃ¡tÅ¯**, 70+ vÃ½robcÅ¯, auto-%, hodnocenÃ­ | âœ… |
| **PÅ™edplatnÃ©** | GPWebPay, iDoklad, multi-mÄ›na, geolokace | âœ… |
| **Lokalizace** | 31 jazykÅ¯, 903 klÃ­ÄÅ¯, plnÄ› synchronizovanÃ© | âœ… **AKTUALIZOVÃNO** |
| **MobilnÃ­** | PWA (iOS/Android), offline, push, FCM | âœ… |

---

### NOVÃ KONKURENÄŒNÃ VÃHODA: DATABÃZE PÅ˜ÃCHUTÃ

**Co jsme pÅ™idali:**
- âœ… **3866 ovÄ›Å™enÃ½ch koncentrÃ¡tÅ¯** s pÅ™esnÃ½mi % dÃ¡vkovÃ¡nÃ­
- âœ… **70+ aktivnÃ­ch vÃ½robcÅ¯** (EU fokus: CZ, PL, IT, UK, FR, DE, SI)
- âœ… **AutomatickÃ© doplnÄ›nÃ­ %** pÅ™i vÃ½bÄ›ru pÅ™Ã­chutÄ›
- âœ… **UpozornÄ›nÃ­ na neovÄ›Å™enÃ© pÅ™Ã­chutÄ›** - bezpeÄnost uÅ¾ivatele
- âœ… **VG/PG ratio** pro kaÅ¾dÃ½ koncentrÃ¡t (dÅ¯leÅ¾itÃ© pro vÃ½poÄty)

**ProÄ je to game-changer:**

| Funkce | Konkurence | LiquiMixer |
|--------|------------|------------|
| DatabÃ¡ze pÅ™Ã­chutÃ­ | âŒ Å½Ã¡dnÃ¡ nebo zastaralÃ¡ | âœ… **3866 ovÄ›Å™enÃ½ch** |
| AutomatickÃ© % | âŒ UÅ¾ivatel musÃ­ hledat | âœ… DoplnÃ­ se automaticky |
| OvÄ›Å™enÃ¡ data | âŒ KomunitnÃ­ (nespolehlivÃ¡) | âœ… Z oficiÃ¡lnÃ­ch zdrojÅ¯ |
| VarovÃ¡nÃ­ bezpeÄnosti | âŒ Å½Ã¡dnÃ© | âœ… UpozornÄ›nÃ­ na chybÄ›jÃ­cÃ­ data |

---

### DOPAD NA KONVERZI A RETENCI

**PÅ™ed databÃ¡zÃ­ pÅ™Ã­chutÃ­:**
- UÅ¾ivatel musel znÃ¡t % dÃ¡vkovÃ¡nÃ­
- VysokÃ¡ bariÃ©ra pro zaÄÃ¡teÄnÃ­ky
- Riziko chyb â†’ Å¡patnÃ¡ zkuÅ¡enost

**Po databÃ¡zi pÅ™Ã­chutÃ­:**
- ZaÄÃ¡teÄnÃ­k vybere pÅ™Ã­chuÅ¥ â†’ % se doplnÃ­ automaticky
- ProfesionÃ¡l uÅ¡etÅ™Ã­ Äas
- SnÃ­Å¾enÃ© riziko chyb â†’ lepÅ¡Ã­ zkuÅ¡enost

**OdhadovanÃ½ dopad:**

| Metrika | PÅ™ed | Po | ZmÄ›na |
|---------|------|-----|-------|
| Konverze (trialâ†’paid) | 7-8% | 9-11% | **+2-3%** |
| Retence (30 dnÃ­) | 35% | 45% | **+10%** |
| NPS score | 40 | 55 | **+15** |

---

### AKTUALIZOVANÃ‰ PREDIKCE 2026-2030 (revize 11.02.2026)

**KlÃ­ÄovÃ© pÅ™edpoklady:**
- âœ… VeÅ™ejnÃ¡ databÃ¡ze receptÅ¯ (funguje)
- âœ… Stock tracking (funguje)
- âœ… Hookah/Shisha formulÃ¡Å™ (implementovÃ¡no)
- âœ… DatabÃ¡ze pÅ™Ã­chutÃ­ (**3866 koncentrÃ¡tÅ¯**, 70+ vÃ½robcÅ¯)
- âœ… AutomatickÃ© doplnÄ›nÃ­ % (snÃ­Å¾enÃ­ bariÃ©ry pro zaÄÃ¡teÄnÃ­ky)
- âœ… 31 jazykÅ¯ plnÄ› synchronizovanÃ½ch (903 klÃ­ÄÅ¯)
- âœ… SystÃ©m hodnocenÃ­ receptÅ¯ a pÅ™Ã­chutÃ­
- âœ… RozÅ¡Ã­Å™enÃ­ na 3866 pÅ™Ã­chutÃ­ (splnÄ›no pÅ™ed termÃ­nem!)
- ğŸ“ˆ RozÅ¡Ã­Å™enÃ­ na 5000+ pÅ™Ã­chutÃ­ do Q3 2026
- ğŸ“ˆ PostupnÃ© zvyÅ¡ovÃ¡nÃ­ cen (viz nÃ­Å¾e)
- ğŸ“ˆ VyÅ¡Å¡Ã­ konverze dÃ­ky novÃ½m funkcÃ­m (+2-3%)

#### RealistickÃ½ scÃ©nÃ¡Å™ (AKTUALIZOVÃNO 11.02.2026)

| Rok | AktivnÃ­ uÅ¾ivatelÃ© | PlatÃ­cÃ­ | Konverze | CZ cena | EU cena | Mimo EU | RoÄnÃ­ pÅ™Ã­jem |
|-----|-------------------|---------|----------|---------|---------|---------|--------------|
| 2026 | 180 000 | 14 400 | 8% | 59 CZK | 2.40 â‚¬ | 2.90 USD | **34 560 â‚¬** |
| 2027 | 500 000 | 45 000 | 9% | 79 CZK | 2.90 â‚¬ | 3.50 USD | **156 600 â‚¬** |
| 2028 | 1 000 000 | 100 000 | 10% | 99 CZK | 3.60 â‚¬ | 4.30 USD | **432 000 â‚¬** |
| 2029 | 1 800 000 | 198 000 | 11% | 119 CZK | 4.20 â‚¬ | 5.00 USD | **998 640 â‚¬** |
| 2030 | 2 800 000 | 308 000 | 11% | 139 CZK | 4.80 â‚¬ | 5.80 USD | **1 774 080 â‚¬** |

**ZdÅ¯vodnÄ›nÃ­ navÃ½Å¡enÃ­ cen:**

| Rok | NavÃ½Å¡enÃ­ | PÅ™idanÃ¡ hodnota |
|-----|----------|-----------------|
| 2027 | +21% | 5000+ ovÄ›Å™enÃ½ch pÅ™Ã­chutÃ­, AI doporuÄenÃ­ |
| 2028 | +24% | Marketplace pÅ™Ã­chutÃ­, sociÃ¡lnÃ­ funkce, komunita |
| 2029 | +17% | KalkulÃ¡tor nÃ¡kladÅ¯, affiliate, klonovÃ¡nÃ­ komerÄnÃ­ch liquidÅ¯ |
| 2030 | +14% | EtablovanÃ½ leader, premium tier |

**ZmÄ›na vs. pÅ¯vodnÃ­ predikce:**

| Metrika | PÅ¯vodnÃ­ (bez DB pÅ™Ã­chutÃ­) | AktualizovanÃ¡ | RozdÃ­l |
|---------|---------------------------|---------------|--------|
| 2030 uÅ¾ivatelÃ© | 2.5 mil | 2.8 mil | **+12%** |
| 2030 platÃ­cÃ­ | 250 000 | 308 000 | **+23%** |
| 2030 ARR | 1 200 000 â‚¬ | 1 774 080 â‚¬ | **+48%** |

---

### SEGMENTACE UÅ½IVATELÅ®

| Segment | PodÃ­l | Konverze | PotÅ™eby | Jak je obslouÅ¾Ã­me |
|---------|-------|----------|---------|-------------------|
| **Hobby vapeÅ™i** | 60% | 6% | Jednoduchost, nÃ¡vody | DatabÃ¡ze pÅ™Ã­chutÃ­, auto-% |
| **Profi DIY** | 25% | 15% | Flexibilita, pÅ™esnost | Liquid PRO, vlastnÃ­ pÅ™Ã­chutÄ› |
| **Shisha nadÅ¡enci** | 15% | 12% | UnikÃ¡tnÃ­ funkce | Shisha formulÃ¡Å™ (nulovÃ¡ konkurence) |

**TAM:** 55-65 mil potenciÃ¡lnÃ­ch uÅ¾ivatelÅ¯ (Vaping DIY + Shisha/Hookah)

---

### SCÃ‰NÃÅ˜E NAVÃÅ ENÃ CEN (strategie postupnÃ©ho zvyÅ¡ovÃ¡nÃ­)

**AktuÃ¡lnÃ­ ceny (Ãºnor 2026):**
- CZ: 59 CZK/mÄ›sÃ­c (~2.36 â‚¬)
- EU: 2.40 â‚¬/mÄ›sÃ­c
- Mimo EU: 2.90 USD/mÄ›sÃ­c

**PlÃ¡novanÃ© navÃ½Å¡enÃ­ s pÅ™idanou hodnotou:**

| Rok | CZ | EU | Mimo EU | PÅ™idanÃ¡ hodnota | % navÃ½Å¡enÃ­ |
|-----|----|----|---------|-----------------|------------|
| 2026 | 59 CZK | 2.40 â‚¬ | 2.90 USD | **3866 pÅ™Ã­chutÃ­**, auto-%, 31 jazykÅ¯ | - |
| 2027 | 79 CZK | 2.90 â‚¬ | 3.50 USD | 5000+ pÅ™Ã­chutÃ­, AI doporuÄenÃ­ | +21% |
| 2028 | 99 CZK | 3.60 â‚¬ | 4.30 USD | Marketplace, sociÃ¡lnÃ­ funkce | +24% |
| 2029 | 119 CZK | 4.20 â‚¬ | 5.00 USD | KalkulÃ¡tor nÃ¡kladÅ¯, affiliate | +17% |
| 2030 | 139 CZK | 4.80 â‚¬ | 5.80 USD | Premium tier, etablovanÃ½ leader | +14% |

**CelkovÃ© navÃ½Å¡enÃ­ 2026â†’2030: +100% (zdvojnÃ¡sobenÃ­ ceny)**

---

### ğŸ† DETAILNÃ SROVNÃNÃ S KONKURENCÃ (aktualizovÃ¡no 11.02.2026)

#### HlavnÃ­ konkurenti na trhu DIY e-liquid kalkulÃ¡torÅ¯:

| Funkce | ğŸ¥‡ LiquiMixer | E-Liquid Recipes (ELR) | All The Flavors (ATF) | eJuice Calc | Vape Tool Pro | Liquix |
|--------|---------------|------------------------|----------------------|-------------|---------------|--------|
| **Platforma** | PWA (web+iOS+Android) | Web only | Web + Android | Web + Android | Android only | Android only |
| **iOS podpora** | âœ… PlnÃ¡ (PWA) | âš ï¸ Jen web | âš ï¸ Jen web | âš ï¸ Jen web | âŒ OmezenÃ¡ | âŒ Ne |
| **Cena/mÄ›sÃ­c** | **2.40 â‚¬** | Zdarma | ~2 â‚¬ | ~3.50 â‚¬ | 2.99 â‚¬ jednorÃ¡zovÄ› | Zdarma |
| **PÅ™Ã­chutÃ­ v DB** | **3866** | ~10 000+ (komunitnÃ­) | ~8 000 (kurÃ¡torskÃ¡) | 0 | ~200 | ~4 000 |
| **OvÄ›Å™enÃ¡ data** | âœ… OficiÃ¡lnÃ­ | âŒ KomunitnÃ­ | âš ï¸ ÄŒÃ¡steÄnÄ› | âŒ | âŒ | âŒ KomunitnÃ­ |
| **Auto-% dÃ¡vkovÃ¡nÃ­** | âœ… | âŒ | âš ï¸ ÄŒÃ¡steÄnÄ› | âŒ | âŒ | âŒ |
| **PoÄet jazykÅ¯** | **31** | 1 (EN) | 1 (EN) | ~5 | ~12 | ~8 |
| **Shisha/Hookah** | âœ… **UnikÃ¡tnÃ­** | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Dilute kalkulÃ¡tor** | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Shake & Vape** | âœ… | âš ï¸ ManuÃ¡lnÃ­ | âš ï¸ ManuÃ¡lnÃ­ | âš ï¸ | âŒ | âš ï¸ |
| **Liquid PRO (multi-flavor)** | âœ… | âœ… | âœ… | âœ… | âš ï¸ OmezenÃ© | âœ… |
| **UklÃ¡dÃ¡nÃ­ receptÅ¯** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **SdÃ­lenÃ­ receptÅ¯** | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **VeÅ™ejnÃ¡ DB receptÅ¯** | âœ… | âœ… (nejvÄ›tÅ¡Ã­) | âœ… (kurÃ¡torskÃ¡) | âš ï¸ | âŒ | âœ… |
| **HodnocenÃ­ receptÅ¯** | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… |
| **HodnocenÃ­ pÅ™Ã­chutÃ­** | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **PÅ™ipomÃ­nky zrÃ¡nÃ­** | âœ… Push notif. | âŒ | âŒ | âŒ | âŒ | âš ï¸ ManuÃ¡lnÃ­ |
| **Sklad produktÅ¯** | âœ… | âœ… (stash) | âœ… | âŒ | âœ… | âœ… |
| **KalkulÃ¡tor nÃ¡kladÅ¯** | ğŸ“… PlÃ¡novÃ¡no | âš ï¸ ZÃ¡kladnÃ­ | âš ï¸ ZÃ¡kladnÃ­ | âŒ | âŒ | âœ… |
| **Offline reÅ¾im** | âœ… (PWA) | âŒ | âŒ | âš ï¸ | âœ… | âœ… |
| **Push notifikace** | âœ… FCM | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Geolokace DPH** | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **PlatebnÃ­ brÃ¡ny** | GPWebPay, multi-mÄ›na | - | Stripe | Patreon | Google Play | - |
| **Fakturace** | âœ… iDoklad | âŒ | âŒ | âŒ | âŒ | âŒ |

---

#### ğŸ¯ SILNÃ‰ STRÃNKY LIQUIMIXER

| VÃ½hoda | Popis | Dopad na konverzi |
|--------|-------|-------------------|
| **JedinÃ½ Shisha kalkulÃ¡tor** | NulovÃ¡ konkurence v segmentu hookah | +15% uÅ¾ivatelÅ¯ z hookah komunity |
| **3866 ovÄ›Å™enÃ½ch pÅ™Ã­chutÃ­** | NejvÄ›tÅ¡Ã­ ovÄ›Å™enÃ¡ DB (ne komunitnÃ­) | +2-3% konverze, snÃ­Å¾enÃ­ bariÃ©ry |
| **31 jazykÅ¯** | 6Ã— vÃ­ce neÅ¾ konkurence | +40% mezinÃ¡rodnÃ­ch uÅ¾ivatelÅ¯ |
| **PlnÃ¡ iOS podpora** | PWA funguje jako nativnÃ­ app | +30% uÅ¾ivatelÅ¯ (iOS = 50% trhu) |
| **Auto-% dÃ¡vkovÃ¡nÃ­** | UnikÃ¡tnÃ­ funkce | SnÃ­Å¾enÃ­ chyb zaÄÃ¡teÄnÃ­kÅ¯ |
| **Push notifikace zrÃ¡nÃ­** | JedinÃ­ s FCM | VyÅ¡Å¡Ã­ retence (+10%) |
| **Offline reÅ¾im** | PWA cache | PouÅ¾itelnÃ© bez internetu |
| **Geolokace + multi-mÄ›na** | AutomatickÃ¡ lokalizace | LepÅ¡Ã­ UX, vyÅ¡Å¡Ã­ konverze |

---

#### âš ï¸ SLABÃ‰ STRÃNKY LIQUIMIXER (vs. konkurence)

| NevÃ½hoda | Konkurent s vÃ½hodou | PlÃ¡n Å™eÅ¡enÃ­ |
|----------|---------------------|-------------|
| MenÅ¡Ã­ komunita receptÅ¯ | ELR (~50k receptÅ¯) | VeÅ™ejnÃ¡ DB, sdÃ­lenÃ­, import |
| Å½Ã¡dnÃ½ kalkulÃ¡tor nÃ¡kladÅ¯ | Liquix | PlÃ¡novÃ¡no Q2 2026 |
| Å½Ã¡dnÃ© AI doporuÄenÃ­ | Å½Ã¡dnÃ½ (pÅ™Ã­leÅ¾itost!) | PlÃ¡novÃ¡no Q3 2026 |
| NativnÃ­ app chybÃ­ | Vape Tool | PWA = dostateÄnÃ©, App Store listing plÃ¡novÃ¡n |

---

#### ğŸ“Š SHRNUTÃ POZICE NA TRHU

| Segment | LiquiMixer pozice | HlavnÃ­ konkurent |
|---------|-------------------|------------------|
| **Vaping DIY (zaÄÃ¡teÄnÃ­ci)** | ğŸ¥‡ NejlepÅ¡Ã­ | eJuice Calc |
| **Vaping DIY (pokroÄilÃ­)** | ğŸ¥ˆ DobrÃ¡ | ELR, ATF |
| **Shisha/Hookah** | ğŸ¥‡ **Monopol** | Å½Ã¡dnÃ½ |
| **MezinÃ¡rodnÃ­ trh** | ğŸ¥‡ NejlepÅ¡Ã­ | Å½Ã¡dnÃ½ (EN only) |
| **iOS uÅ¾ivatelÃ©** | ğŸ¥‡ NejlepÅ¡Ã­ | ELR (jen web) |

**CelkovÃ© hodnocenÃ­: LiquiMixer je nejkompletnÄ›jÅ¡Ã­ Å™eÅ¡enÃ­ na trhu s unikÃ¡tnÃ­mi funkcemi (Shisha, 31 jazykÅ¯, auto-%) a nejlepÅ¡Ã­m pomÄ›rem cena/hodnota.**

---

### TÅ˜I SCÃ‰NÃÅ˜E PÅ˜ÃJMÅ® 2026-2030 (aktualizovÃ¡no 11.02.2026)

---

#### ğŸ”´ PESIMISTICKÃ SCÃ‰NÃÅ˜
*PÅ™edpoklady: PomalÃ½ rÅ¯st, vysokÃ¡ konkurence, niÅ¾Å¡Ã­ konverze, bez navÃ½Å¡enÃ­ cen*

| Rok | AktivnÃ­ uÅ¾ivatelÃ© | PlatÃ­cÃ­ | Konverze | PrÅ¯mÄ›rnÃ¡ cena | RoÄnÃ­ pÅ™Ã­jem | KumulativnÃ­ |
|-----|-------------------|---------|----------|---------------|--------------|-------------|
| 2026 | 100 000 | 5 000 | 5% | 2.40 â‚¬ | 12 000 â‚¬ | 12 000 â‚¬ |
| 2027 | 200 000 | 12 000 | 6% | 2.40 â‚¬ | 28 800 â‚¬ | 40 800 â‚¬ |
| 2028 | 350 000 | 24 500 | 7% | 2.60 â‚¬ | 63 700 â‚¬ | 104 500 â‚¬ |
| 2029 | 500 000 | 40 000 | 8% | 2.80 â‚¬ | 112 000 â‚¬ | 216 500 â‚¬ |
| 2030 | 700 000 | 63 000 | 9% | 3.00 â‚¬ | 189 000 â‚¬ | **405 500 â‚¬** |

---

#### ğŸŸ¡ REALISTICKÃ SCÃ‰NÃÅ˜
*PÅ™edpoklady: StabilnÃ­ rÅ¯st, postupnÃ© navyÅ¡ovÃ¡nÃ­ cen s pÅ™idanou hodnotou*

| Rok | AktivnÃ­ uÅ¾ivatelÃ© | PlatÃ­cÃ­ | Konverze | CZ cena | EU cena | RoÄnÃ­ pÅ™Ã­jem | KumulativnÃ­ |
|-----|-------------------|---------|----------|---------|---------|--------------|-------------|
| 2026 | 180 000 | 14 400 | 8% | 59 CZK | 2.40 â‚¬ | 34 560 â‚¬ | 34 560 â‚¬ |
| 2027 | 500 000 | 45 000 | 9% | 79 CZK | 2.90 â‚¬ | 156 600 â‚¬ | 191 160 â‚¬ |
| 2028 | 1 000 000 | 100 000 | 10% | 99 CZK | 3.60 â‚¬ | 432 000 â‚¬ | 623 160 â‚¬ |
| 2029 | 1 800 000 | 198 000 | 11% | 119 CZK | 4.20 â‚¬ | 998 640 â‚¬ | 1 621 800 â‚¬ |
| 2030 | 2 800 000 | 308 000 | 11% | 139 CZK | 4.80 â‚¬ | 1 774 080 â‚¬ | **3 395 880 â‚¬** |

---

#### ğŸŸ¢ OPTIMISTICKÃ SCÃ‰NÃÅ˜
*PÅ™edpoklady: VirÃ¡lnÃ­ rÅ¯st, App Store featuring, rychlÃ© navÃ½Å¡enÃ­ cen, premium tier*

| Rok | AktivnÃ­ uÅ¾ivatelÃ© | PlatÃ­cÃ­ | Konverze | CZ cena | EU cena | RoÄnÃ­ pÅ™Ã­jem | KumulativnÃ­ |
|-----|-------------------|---------|----------|---------|---------|--------------|-------------|
| 2026 | 300 000 | 30 000 | 10% | 59 CZK | 2.40 â‚¬ | 72 000 â‚¬ | 72 000 â‚¬ |
| 2027 | 1 000 000 | 120 000 | 12% | 89 CZK | 3.20 â‚¬ | 460 800 â‚¬ | 532 800 â‚¬ |
| 2028 | 2 500 000 | 350 000 | 14% | 119 CZK | 4.50 â‚¬ | 1 890 000 â‚¬ | 2 422 800 â‚¬ |
| 2029 | 4 500 000 | 675 000 | 15% | 149 CZK | 5.50 â‚¬ | 4 455 000 â‚¬ | 6 877 800 â‚¬ |
| 2030 | 7 000 000 | 1 120 000 | 16% | 179 CZK | 6.50 â‚¬ | 8 736 000 â‚¬ | **15 613 800 â‚¬** |

---

#### SROVNÃNÃ SCÃ‰NÃÅ˜Å®

| Metrika | ğŸ”´ PesimistickÃ½ | ğŸŸ¡ RealistickÃ½ | ğŸŸ¢ OptimistickÃ½ |
|---------|-----------------|----------------|-----------------|
| **2030 uÅ¾ivatelÃ©** | 700 000 | 2 800 000 | 7 000 000 |
| **2030 platÃ­cÃ­** | 63 000 | 308 000 | 1 120 000 |
| **2030 konverze** | 9% | 11% | 16% |
| **2030 ARR** | 189 000 â‚¬ | 1 774 080 â‚¬ | 8 736 000 â‚¬ |
| **KumulativnÃ­ 5Y** | **405 500 â‚¬** | **3 395 880 â‚¬** | **15 613 800 â‚¬** |

---

#### RIZIKA A PÅ˜ÃLEÅ½ITOSTI

**Rizika (pesimistickÃ½):**
- Regulace e-cigaret v EU (TPD3)
- SilnÃ¡ konkurence od velkÃ½ch hrÃ¡ÄÅ¯
- PomalÃ¡ adopce PWA vs nativnÃ­ app
- EkonomickÃ¡ recese â†’ snÃ­Å¾enÃ­ diskr. vÃ½dajÅ¯

**PÅ™Ã­leÅ¾itosti (optimistickÃ½):**
- App Store / Play Store featuring
- VirÃ¡lnÃ­ Å¡Ã­Å™enÃ­ pÅ™es TikTok/Instagram
- PartnerstvÃ­ s velkÃ½mi e-shop
- Expanze na asijskÃ© trhy (Japonsko, Korea)
- Shisha segment bez konkurence

---

### DALÅ Ã KROKY (Q1-Q2 2026)

1. ~~**RozÅ¡Ã­Å™enÃ­ databÃ¡ze pÅ™Ã­chutÃ­** na 3500+~~ âœ… SPLNÄšNO (aktuÃ¡lnÄ› 3866)
2. **App Store / Play Store** listing (ÄekÃ¡ Apple approval)
3. **NapojenÃ­ pÅ™Ã­chutÃ­ na recepty** - zobrazenÃ­ detailu pÅ™Ã­chutÄ› v receptu (plÃ¡novÃ¡no 12.02.2026)
4. **Editace receptÅ¯ s pÅ™Ã­chutÄ›mi** - pÅ™edvyplnÄ›nÃ­ uloÅ¾enÃ½ch pÅ™Ã­chutÃ­ pÅ™i editaci

---

### PLÃNOVANÃ‰ FUNKCE (po rollout)

| Funkce | Popis | Priorita | Dopad na konverzi |
|--------|-------|----------|-------------------|
| **AI doporuÄenÃ­ pÅ™Ã­chutÃ­** | "Pokud vÃ¡m chutnÃ¡ X, zkuste Y" na zÃ¡kladÄ› preferencÃ­ a hodnocenÃ­ | VysokÃ¡ | +2-3% |
| **SociÃ¡lnÃ­ funkce / Komunita** | SledovÃ¡nÃ­ tvÅ¯rcÅ¯, feed s novÃ½mi recepty, komentÃ¡Å™e | VysokÃ¡ | +15% retence |
| **KalkulÃ¡tor nÃ¡kladÅ¯** | PropojenÃ­ produktÅ¯ s cenami, "Recept stojÃ­ X KÄ" | StÅ™ednÃ­ | ZvÃ½Å¡enÃ­ hodnoty PRO |
| **KlonovÃ¡nÃ­ komerÄnÃ­ch liquidÅ¯** | DatabÃ¡ze populÃ¡rnÃ­ch e-liquidÅ¯ s recepturami | StÅ™ednÃ­ | PÅ™ilÃ¡kÃ¡nÃ­ novÃ½ch uÅ¾ivatelÅ¯ |
| **NÃ¡kupnÃ­ seznam** | GenerovÃ¡nÃ­ seznamu chybÄ›jÃ­cÃ­ch ingrediencÃ­ z receptu | StÅ™ednÃ­ | Affiliate pÅ™Ã­jmy |
| **TmavÃ½ reÅ¾im** | Dark theme pro PWA | NÃ­zkÃ¡ | UX standard |
| **Historie vÃ½poÄtÅ¯** | PÅ™ehled poslednÃ­ch kalkulacÃ­ bez uklÃ¡dÃ¡nÃ­ | NÃ­zkÃ¡ | Convenience |
| **PorovnÃ¡nÃ­ receptÅ¯** | Dva recepty vedle sebe | NÃ­zkÃ¡ | Pro pokroÄilÃ© |
| **QR kÃ³dy sdÃ­lenÃ­** | RychlÃ© sdÃ­lenÃ­ receptu pÅ™es QR | NÃ­zkÃ¡ | VirÃ¡lnÃ­ Å¡Ã­Å™enÃ­ |

---

## ğŸŒŸ IMPLEMENTOVANÃ‰ FUNKCE (2026-02-09)

### âœ… DatabÃ¡ze pÅ™Ã­chutÃ­ - IMPLEMENTOVÃNO

**KompletnÃ­ implementace databÃ¡ze pÅ™Ã­chutÃ­ s nÃ¡sledujÃ­cÃ­mi funkcemi:**

**DatabÃ¡zovÃ© tabulky:**
- `flavor_manufacturers` - vÃ½robci pÅ™Ã­chutÃ­ (CAP, TPA, FA, ALF, ADA...)
- `flavors` - pÅ™Ã­chutÄ› s doporuÄenÃ½m %, steep time, kategoriÃ­
- `flavor_ratings` - hodnocenÃ­ pÅ™Ã­chutÃ­ uÅ¾ivateli
- `recipe_flavors` - vazba recept-pÅ™Ã­chuÅ¥
- RozÅ¡Ã­Å™enÃ­ `favorite_products` o flavor-specifickÃ¡ pole

**Migrace:** `supabase/migrations/20260209_*.sql`

**UI funkce:**
- Menu poloÅ¾ka "DatabÃ¡ze pÅ™Ã­chutÃ­" (pro pÅ™ihlÃ¡Å¡enÃ©)
- Seznam s filtry (typ, vÃ½robce, kategorie, hodnocenÃ­)
- Detail pÅ™Ã­chutÄ› s hodnocenÃ­m
- UloÅ¾enÃ­ do oblÃ­benÃ½ch

**FormulÃ¡Å™ oblÃ­benÃ½ch produktÅ¯:**
- RozÅ¡Ã­Å™enÃ¡ pole pro pÅ™Ã­chutÄ› (typ vape/shisha, vÃ½robce, steep days, %)
- Toggle "Navrhnout do databÃ¡ze" s rate limiting (5/tÃ½den)

**Autocomplete v receptech:**
- KombinovanÃ© hledÃ¡nÃ­ z oblÃ­benÃ½ch + veÅ™ejnÃ© DB
- VarovÃ¡nÃ­ pÅ™i konfliktu typu (vape vs shisha)
- Auto-nastavenÃ­ doporuÄenÃ©ho %

**n8n workflow:** `docs/n8n-flavor-verification-workflow.md`
- AutomatickÃ¡ verifikace nÃ¡vrhÅ¯ AI agentem
- Email notifikace o schvÃ¡lenÃ­/zamÃ­tnutÃ­

**Seed data:**
- 10 testovacÃ­ch pÅ™Ã­chutÃ­: `20260209_seed_test_flavors.sql`
- ProdukÄnÃ­ seed (~100 pÅ™Ã­chutÃ­): `seed_production_flavors.sql`

**API funkce (database.js):**
- `getFlavorManufacturers()`, `searchFlavors()`, `getFlavorById()`
- `addFlavorRating()`, `getUserFlavorRating()`
- `submitFlavorSuggestion()`, `getUserSuggestionCount()`
- `searchFlavorsForAutocomplete()`, `saveFlavorToFavorites()`

**PÅ™eklady:** NovÃ© klÃ­Äe ve vÅ¡ech 31 locale souborech
- `flavor_database.*`, `flavor_suggestion.*`
- `flavor_form.*`, `flavor_autocomplete.*`, `flavor_categories.*`

---

## ğŸ“… DENNÃ ZÃZNAMY

### 13.02.2026 - Oprava else vÄ›tve doladÄ›nÃ­ a updateSvVgPgLimits

**ProblÃ©m:**
- V `calculateMix()`, `calculateShakeVape()`, `calculateProMix()`, `calculateShishaMix()` - else vÄ›tev pÅ™i "ani jedna varianta nenÃ­ realizovatelnÃ¡" nastavovala `adjustmentVg = 0; adjustmentPg = 0;`
- To znamenalo, Å¾e se doladÄ›nÃ­ nikdy nepÅ™idalo do receptu, i kdyÅ¾ bylo matematicky moÅ¾nÃ©
- `updateSvVgPgLimits()` nerozliÅ¡oval mezi premixed/separate reÅ¾imem

**Opraveno:**

1. **`updateSvVgPgLimits()`:**
   - PÅ™idÃ¡na detekce premixed/separate reÅ¾imu
   - Pro premixed reÅ¾im se poÄÃ­tÃ¡ s celÃ½m zbÃ½vajÃ­cÃ­m objemem (bÃ¡ze + doladÄ›nÃ­)

2. **Else vÄ›tve ve vÅ¡ech calculate funkcÃ­ch:**
   - `calculateMix()` - else vÄ›tev nynÃ­ sprÃ¡vnÄ› poÄÃ­tÃ¡ doladÄ›nÃ­
   - `calculateShakeVape()` - else vÄ›tev nynÃ­ sprÃ¡vnÄ› poÄÃ­tÃ¡ doladÄ›nÃ­
   - `calculateProMix()` - else vÄ›tev nynÃ­ sprÃ¡vnÄ› poÄÃ­tÃ¡ doladÄ›nÃ­
   - `calculateShishaMix()` - else vÄ›tev nynÃ­ sprÃ¡vnÄ› poÄÃ­tÃ¡ doladÄ›nÃ­
   - Logika: pouÅ¾ijeme celou bÃ¡zi a doladÃ­me chybÄ›jÃ­cÃ­ VG nebo PG

**DÅ¯sledek oprav:**
- KdyÅ¾ uÅ¾ivatel zmÄ›nÃ­ pomÄ›r VG/PG z pÅ™edvypoÄÃ­tanÃ©ho, doladÄ›nÃ­ se sprÃ¡vnÄ› zobrazÃ­ v receptu
- VÅ¡echny 4 formulÃ¡Å™e nynÃ­ konzistentnÄ› poÄÃ­tajÃ­ doladÄ›nÃ­

---

### 13.02.2026 - SjednocenÃ­ VG/PG vÃ½poÄtÅ¯ a oprava automatickÃ©ho pÅ™ednastavenÃ­

**ProblÃ©m:**
- 3 rÅ¯znÃ© vÃ½poÄty VG/PG (limity, pÅ™ednastavenÃ­, finÃ¡lnÃ­ kalkulace) pouÅ¾Ã­valy nekonzistentnÃ­ logiku
- `calculateActualVgPgRatio()` pro PRO nepoÄÃ­tala s aditivy
- `calculateActualVgPgRatio()` pro Shisha nepoÄÃ­tala se sladidlem a vodou
- Slider se automaticky pÅ™episoval i po ruÄnÃ­ zmÄ›nÄ› uÅ¾ivatelem

**Opraveno:**

1. **`calculateActualVgPgRatio()` - pÅ™idÃ¡ny chybÄ›jÃ­cÃ­ sloÅ¾ky:**
   - Pro Shisha: pÅ™idÃ¡n vÃ½poÄet `sweetenerVolume` a `waterVolume` do `extraNonVgPgVolume`
   - Pro PRO: pÅ™idÃ¡n vÃ½poÄet `totalAdditiveVolume` do `extraNonVgPgVolume`
   - Opraveno `remainingVolume = totalAmount - nicotineVolume - flavorVolume - extraNonVgPgVolume`

2. **Flagy pro ruÄnÃ­ zmÄ›nu slideru:**
   - PÅ™idÃ¡ny globÃ¡lnÃ­ flagy: `liquidUserManuallyChangedRatio`, `proUserManuallyChangedRatio`, `shishaUserManuallyChangedRatio`, `shakevapeUserManuallyChangedRatio`
   - Flagy se nastavujÃ­ na `true` kdyÅ¾ uÅ¾ivatel ruÄnÄ› pohne sliderem
   - AutomatickÃ© pÅ™ednastavenÃ­ slideru se provede POUZE pokud flag je `false`
   - Flagy se resetujÃ­ pÅ™i:
     - ZmÄ›nÄ› typu bÃ¡ze (separate/premixed) - `updateBaseType()`, `updateProBaseType()`, `updateShishaBaseType()`, `updateSvBaseType()`
     - Inicializaci formulÃ¡Å™e - `initShakeVapeForm()`, `initLiquidProForm()`, `initShishaForm()`

3. **UpravenÃ© funkce:**
   - `updatePremixedRatio()` - respektuje `liquidUserManuallyChangedRatio`
   - `autoRecalculateLiquidVgPgRatio()` - respektuje `liquidUserManuallyChangedRatio`
   - `updateProPremixedRatio()` - respektuje `proUserManuallyChangedRatio`
   - `autoRecalculateShishaVgPgRatio()` - respektuje `shishaUserManuallyChangedRatio`
   - `updateSvPremixedRatio()` - respektuje `shakevapeUserManuallyChangedRatio`
   - `autoRecalculateSvVgPgRatio()` - respektuje `shakevapeUserManuallyChangedRatio`

**DÅ¯sledek oprav:**
- VÃ½poÄty jsou nynÃ­ konzistentnÃ­ napÅ™Ã­Ä vÅ¡emi 3 mÃ­sty
- KdyÅ¾ uÅ¾ivatel zmÄ›nÃ­ pÅ™edvypoÄÃ­tanÃ½ pomÄ›r, doladÄ›nÃ­ se sprÃ¡vnÄ› zobrazÃ­ v receptu
- KdyÅ¾ uÅ¾ivatel pouÅ¾ije pÅ™edvypoÄÃ­tanÃ½ pomÄ›r (bez zmÄ›ny), doladÄ›nÃ­ se nepoÄÃ­tÃ¡
- Slider se nepÅ™episuje po ruÄnÃ­ zmÄ›nÄ› uÅ¾ivatelem

---

### 13.02.2026 - Oprava detailnÃ­ kompozice pÅ™Ã­chutÃ­ pro PRO formulÃ¡Å™

**ProblÃ©m:**
- PRO formulÃ¡Å™ mÃ¡ panel "SloÅ¾enÃ­ pÅ™Ã­chutÄ›" (PG, VG, alkohol, voda, ostatnÃ­), ale data se nepouÅ¾Ã­vala ve vÃ½poÄtech
- VÃ½poÄty pÅ™edpoklÃ¡daly `PG = 100 - VG`, coÅ¾ ignorovalo alkohol, vodu a ostatnÃ­ sloÅ¾ky
- PÅ™Ã­chuÅ¥ s kompozicÃ­ `PG: 40%, VG: 30%, Alkohol: 20%, Voda: 5%, OstatnÃ­: 5%` byla poÄÃ­tÃ¡na jako `PG: 70%, VG: 30%`

**Opraveno:**

1. **`getProFlavorsData()` (Å™Ã¡dky ~10344-10380):**
   - PÅ™idÃ¡no naÄÃ­tÃ¡nÃ­ `customComposition` z `getFlavorCustomComposition(i)`
   - KaÅ¾dÃ¡ pÅ™Ã­chuÅ¥ nynÃ­ obsahuje `customComposition: { pg, vg, alcohol, water, other }`
   - Pokud uÅ¾ivatel nezadal detailnÃ­ sloÅ¾enÃ­, pouÅ¾ije se fallback na slider (PG = 100 - VG)

2. **`calculateActualVgPgRatio('pro')` (Å™Ã¡dky ~1644-1670):**
   - PÅ™idÃ¡n vÃ½poÄet `totalFlavorVgVolume` z detailnÃ­ kompozice
   - PouÅ¾ita promÄ›nnÃ¡ `directFlavorVgVolume` pro pÅ™Ã­mÃ© VG hodnoty

3. **`updateProVgPgLimits()` (Å™Ã¡dky ~10478-10487):**
   - Upraveno na pouÅ¾itÃ­ `flavor.customComposition.vg` a `flavor.customComposition.pg`

4. **`calculateProMix()` (Å™Ã¡dky ~10637-10645):**
   - Upraveno na pouÅ¾itÃ­ `flavor.customComposition.vg` a `flavor.customComposition.pg`

**DÅ¯sledek oprav:**
- VÅ¡echny 3 vÃ½poÄetnÃ­ body (limity, pÅ™ednastavenÃ­, finÃ¡lnÃ­ recept) nynÃ­ pouÅ¾Ã­vajÃ­ skuteÄnÃ© hodnoty PG a VG
- Alkohol, voda a ostatnÃ­ sloÅ¾ky pÅ™ispÃ­vajÃ­ pouze k celkovÃ©mu objemu, ne do VG/PG pomÄ›ru
- Panel "SloÅ¾enÃ­ pÅ™Ã­chutÄ›" v PRO formulÃ¡Å™i nynÃ­ skuteÄnÄ› ovlivÅˆuje vÃ½poÄty

**ZÃ¡loha vytvoÅ™ena:** `backup_2026-02-13/`

---

### 12.02.2026 - Oprava VG/PG limitÅ¯ a doladÄ›nÃ­ pro premixed bÃ¡ze

**ProblÃ©m:**
- Slider VG/PG pomÄ›ru ukazoval nesprÃ¡vnÃ© limity pÅ™i pouÅ¾itÃ­ pÅ™edmÃ­chanÃ© bÃ¡ze
- PÅ™i ÃºpravÄ› pomÄ›ru VG/PG se nezobrazovalo doladÄ›nÃ­ ve finÃ¡lnÃ­m receptu
- PÅ™i nÃ¡vratu z receptu se posuvnÃ­k vracel na pÅ™edvypoÄÃ­tanou hodnotu mÃ­sto ruÄnÄ› upravenÃ©

**PÅ™Ã­Äina:**
- Funkce `updateVgPgRatioLimits()`, `updateProVgPgLimits()`, `updateShishaVgPgLimits()` nepoÄÃ­taly s fixnÃ­m pomÄ›rem premixed bÃ¡ze
- Slider umoÅ¾Åˆoval nastavit hodnoty, kterÃ© nebylo moÅ¾nÃ© dosÃ¡hnout s vybranou premixed bÃ¡zÃ­
- DoladÄ›nÃ­ VG/PG se nepÅ™idÃ¡valo do `ingredients` array v nÄ›kterÃ½ch formulÃ¡Å™Ã­ch

**Opraveno:**
- âœ… `updateVgPgRatioLimits()` (app.js:6588-6778) - sprÃ¡vnÃ½ vÃ½poÄet limitÅ¯ pro premixed reÅ¾im
- âœ… `updateProVgPgLimits()` (app.js:10281-10360) - vÄetnÄ› aditiv v remainingVolume
- âœ… `updateShishaVgPgLimits()` (app.js:15589-15677) - vÄetnÄ› sladidla a vody
- âœ… `calculateMix()` (app.js:7224-7582) - pÅ™idÃ¡nÃ­ VG/PG doladÄ›nÃ­ do ingredients
- âœ… `calculateShishaMix()` (app.js:15680-16207) - pÅ™idÃ¡nÃ­ VG/PG doladÄ›nÃ­ do ingredients

**OpravenÃ¡ chyba v database.js:**
- âœ… OdstranÄ›ny reference na neexistujÃ­cÃ­ sloupce `flavor_min_percent` a `flavor_max_percent` v `updateFavoriteProduct()` (Å™Ã¡dky 840-885)
- Tyto sloupce neexistujÃ­ v tabulce `favorite_products` - zpÅ¯sobovalo chybu pÅ™i uklÃ¡dÃ¡nÃ­ zmÄ›n oblÃ­benÃ©ho produktu

**Commit:** `e28236c` - "Fix VG/PG slider limits and adjustment for premixed bases"

**ZÃ¡loha vytvoÅ™ena:** `backup_2026-02-12/`

---

### 11.02.2026 - Synchronizace pÅ™ekladÅ¯ vÅ¡ech locale souborÅ¯

**DokonÄeno:**
- âœ… KompletnÃ­ synchronizace vÅ¡ech 31 jazykovÃ½ch souborÅ¯ s `en.json` (903 klÃ­ÄÅ¯)
- âœ… PÅ™idÃ¡ny chybÄ›jÃ­cÃ­ klÃ­Äe:
  - `recipe_database.back_to_database` - 20 jazykÅ¯
  - `results.notes_*` (7 klÃ­ÄÅ¯) - fr.json
  - `subscription.register_first` + `error_not_logged_in` - ko.json
  - `rating.*` (4 klÃ­Äe) - pt.json, ro.json
  - `payment_success_login_required` - 25 jazykÅ¯
  - `subtotal` - 21 jazykÅ¯
  - `auto_note_steeping` - 14 jazykÅ¯
  - `public_disabled_shared` - 14 jazykÅ¯
  - `shortfill_liquid`, `shortfill_base`, `type_locked` - rÅ¯znÃ© jazyky
- âœ… VytvoÅ™en a pouÅ¾it kontrolnÃ­ skript pro ovÄ›Å™enÃ­ kompletnosti

**ZÃ¡loha vytvoÅ™ena:** `backup_2026-02-11/`

---

### Ãškoly na zÃ­tra (12.02.2026):

1. **DatabÃ¡ze receptÅ¯ a navÃ¡zÃ¡nÃ­/zobrazenÃ­ detailu pÅ™Ã­chutÄ›**
   - V detailu receptu zobrazit napojenÃ© pÅ™Ã­chutÄ› s jejich parametry
   - Proklik na detail pÅ™Ã­chutÄ› z receptu
   - Zobrazit min/max %, steep time, vÃ½robce

2. **PÅ™i ÃºpravÄ› uloÅ¾enÃ©ho receptu navÃ¡zat uloÅ¾enÃ© pÅ™Ã­chutÄ› spolu s %**
   - Editace receptu by mÄ›la pÅ™edvyplnit uloÅ¾enÃ© pÅ™Ã­chutÄ›
   - Zachovat procenta nastavenÃ¡ pÅ™i pÅ¯vodnÃ­m uloÅ¾enÃ­
   - SprÃ¡vnÄ› propojit s `recipe_flavors` tabulkou

---

### 10.02.2026 - Oprava vÃ½poÄtu VG/PG s konkrÃ©tnÃ­mi pÅ™Ã­chutÄ›mi

**ProblÃ©m:**
- PÅ™i vÃ½bÄ›ru konkrÃ©tnÃ­ pÅ™Ã­chutÄ› z autocomplete se VG/PG pomÄ›r nepoÄÃ­tal sprÃ¡vnÄ›
- PÅ™Ã­Äina 1: Kontrola `flavorType !== 'none'` selhÃ¡vala - pÅ™i vÃ½bÄ›ru konkrÃ©tnÃ­ pÅ™Ã­chutÄ› se kategorie vyprÃ¡zdnila
- PÅ™Ã­Äina 2: VG ratio se parsovalo pouze na 3 pevnÃ© hodnoty (`0/100`, `80/20`, `70/30`) mÃ­sto dynamickÃ©ho parsovÃ¡nÃ­

**OpravenÃ© funkce:**
- `calculateActualVgPgRatio()` - Liquid a S&V ÄÃ¡st
- `updateVgPgRatioLimits()` - vÃ½poÄet limitÅ¯ slideru
- `calculateMix()` - hlavnÃ­ vÃ½poÄet Liquid
- `updateSvVgPgLimits()` - S&V limity
- `calculateShakeVape()` - S&V vÃ½poÄet

**Å˜eÅ¡enÃ­:**
1. PÅ™idÃ¡na kontrola `hasSpecificFlavor` z autocomplete datasetu
2. NovÃ¡ podmÃ­nka: `hasFlavor = hasSpecificFlavor || (flavorType !== 'none' && flavorType !== '')`
3. DynamickÃ© parsovÃ¡nÃ­ VG ratio: `parseInt(flavorRatio.split('/')[0]) || 0`

**Liquid PRO a Shisha - nebylo potÅ™eba opravovat:**
- Tyto formulÃ¡Å™e pouÅ¾Ã­vajÃ­ `getProFlavorsData()` a `getShishaFlavorsData()`
- Funkce jiÅ¾ sprÃ¡vnÄ› detekujÃ­ konkrÃ©tnÃ­ pÅ™Ã­chutÄ› (`hasSpecific = specificFlavorName !== null`)
- VG ratio se Äte pÅ™Ã­mo ze slideru, ne z toggle buttons

**Commit:** `fix-vgpg-calculation-with-specific-flavors-v195`

---

### 10.02.2026 - Opravy bugÅ¯ z pÅ™edchozÃ­ho dne (pokraÄovÃ¡nÃ­)

**Opraveno v tÃ©to session:**
- âœ… Barva textu pÅ™Ã­chutÄ› - opravena detekce konkrÃ©tnÃ­ pÅ™Ã­chutÄ› v `updateFlavorDisplay()` (kontrola `flavorData.name` mÃ­sto `flavorId`)
- âœ… Shisha pÅ™Ã­chuÅ¥ - pouÅ¾itÃ­ nÃ¡zvu z DB mÃ­sto "vlastnÃ­ pÅ™Ã­chuÅ¥" v `updateShishaFlavorStrength()`
- âœ… MaÄarskÃ© pÅ™eklady - pÅ™idÃ¡ny chybÄ›jÃ­cÃ­ klÃ­Äe `make_public`, `public_hint`, `flavors_label`, `no_flavors` do `hu.json`
- âœ… AnglickÃ© pÅ™eklady - pÅ™idÃ¡ny `flavors_label`, `no_flavors` do `en.json`
- âœ… Parametry pÅ™Ã­chutÃ­ z katalogu - opraveny JOINy v `searchFlavorsForAutocomplete()` a `getFavoriteProducts()` pro zÃ­skÃ¡nÃ­ min%, max%, steep_days, vÃ½robce
- âœ… Shisha uklÃ¡dÃ¡nÃ­ pÅ™Ã­chutÃ­ - opravena logika `isFavorite` v `getShishaFlavorsData()` pro sprÃ¡vnÃ© ID
- âœ… SdÃ­lenÃ­ receptu - pÅ™idÃ¡no naÄÃ­tÃ¡nÃ­ pÅ™Ã­chutÃ­ ze sdÃ­lenÃ©ho receptu v `saveSharedRecipe()`
- âœ… `getLinkedFlavors()` - opraveny JOINy pro sprÃ¡vnÃ© zÃ­skÃ¡nÃ­ parametrÅ¯ pÅ™Ã­chutÃ­ pÅ™es `favorite_products.flavor_id`

**DÅ™Ã­ve opraveno:**
- âœ… `saveFlavorToFavorites()` - pÅ™idÃ¡no chybÄ›jÃ­cÃ­ pole `share_url`
- âœ… PoÄÃ¡teÄnÃ­ barva flavor slideru - pÅ™Ã­mÃ© nastavenÃ­ v `showFlavorSliderWithRange()`
- âœ… PÅ™eklady ingredientÅ¯ - case `sweetener` a `shortfill_base` v `getIngredientName()`

**PoznÃ¡mky k opravÃ¡m:**
- ProblÃ©m s barvou textu BYL v nesprÃ¡vnÃ© detekci konkrÃ©tnÃ­ pÅ™Ã­chutÄ› - kontrolovalo se `flavorId` kterÃ© mohlo bÃ½t prÃ¡zdnÃ½ string
- Pro Shisha se nynÃ­ kontroluje autocomplete data a pouÅ¾Ã­vÃ¡ nÃ¡zev pÅ™Ã­chutÄ› v popisu

**Service Worker:** `liquimixer-v185`

**K testovÃ¡nÃ­:**
- UloÅ¾enÃ­ receptu s pÅ™Ã­chutÃ­ z databÃ¡ze (ovÄ›Å™it navÃ¡zÃ¡nÃ­ v recipe_flavors)
- SdÃ­lenÃ­ receptu od jinÃ©ho uÅ¾ivatele (ovÄ›Å™it kopÃ­rovÃ¡nÃ­ pÅ™Ã­chutÃ­ s parametry)
- Shisha recept s pÅ™Ã­chutÃ­ z databÃ¡ze (ovÄ›Å™it zobrazenÃ­ nÃ¡zvu mÃ­sto "vlastnÃ­ pÅ™Ã­chuÅ¥")

### 09.02.2026 - PrÃ¡ce na databÃ¡zi pÅ™Ã­chutÃ­

**ImplementovÃ¡no:**
- âœ… Autocomplete pro vÃ½bÄ›r konkrÃ©tnÃ­ch pÅ™Ã­chutÃ­ ve formulÃ¡Å™Ã­ch
- âœ… PÅ™enos specifickÃ© pÅ™Ã­chutÄ› do vÃ½sledkÅ¯ receptu (Liquid, Liquid PRO, Shisha)
- âœ… ZobrazenÃ­ nÃ¡zvu pÅ™Ã­chutÄ› a vÃ½robce v ingrediencÃ­ch
- âœ… Oprava VG/PG doladÄ›nÃ­ u pÅ™edmÃ­chanÃ© bÃ¡ze (vÅ¡echny formulÃ¡Å™e)
- âœ… FiltrovÃ¡nÃ­ generickÃ½ch kategoriÃ­ z uklÃ¡dÃ¡nÃ­ do oblÃ­benÃ½ch (jen konkrÃ©tnÃ­ pÅ™Ã­chutÄ›)
- âœ… Oprava `extractRecipeFlavorsForDisplay()` - Å¾Ã¡dnÃ© duplicity

**ÄŒÃ¡steÄnÄ› opraveno:**
- OdstranÄ›ny neexistujÃ­cÃ­ sloupce `flavor_min_percent`, `flavor_max_percent` z `saveFlavorToFavorites()`

**K Å˜EÅ ENÃ NA ZÃTRA:**

1. **RLS policy pro `recipe_flavors`** - INSERT selhÃ¡vÃ¡ s chybou:
   ```
   new row violates row-level security policy
   ```
   - ProblÃ©m: RLS pouÅ¾Ã­vÃ¡ `auth.jwt()->>'sub'`, ale Clerk JWT nenÃ­ sprÃ¡vnÄ› nakonfigurovÃ¡n
   - MoÅ¾nÃ¡ Å™eÅ¡enÃ­:
     a) Nakonfigurovat Clerk JWT template pro Supabase (sprÃ¡vnÄ›jÅ¡Ã­, ale sloÅ¾itÄ›jÅ¡Ã­)
     b) Upravit RLS policy aby nepouÅ¾Ã­vala `auth.jwt()` ale ovÄ›Å™ovala clerk_id jinak
     c) PouÅ¾Ã­t service role pro vklÃ¡dÃ¡nÃ­ (bezpeÄnostnÃ­ riziko)
   - **POZOR:** ZmÄ›na RLS mÅ¯Å¾e ovlivnit i jinÃ© operace!

2. **PoÄÃ¡teÄnÃ­ barva flavor slideru** - slider je ÄervenÃ½ mÃ­sto zelenÃ©ho
   - ProblÃ©m: Po vÃ½bÄ›ru konkrÃ©tnÃ­ pÅ™Ã­chutÄ› se slider zobrazÃ­ s ÄervenÃ½m pozadÃ­m
   - Po ruÄnÃ­m posunutÃ­ se barva opravÃ­ na zelenou
   - Funkce: `showFlavorSliderWithRange()` v app.js
   - PravdÄ›podobnÄ› chybÃ­ poÄÃ¡teÄnÃ­ volÃ¡nÃ­ `updateFlavorSliderColor()` nebo podobnÃ©

3. **ZobrazenÃ­ napojenÃ½ch produktÅ¯ v uloÅ¾enÃ©m receptu**
   - PÅ™i zobrazenÃ­ detailu receptu se nezobrazujÃ­ "PouÅ¾itÃ© produkty"
   - Funkce: `displayRecipeDetail()`, `getLinkedProducts()`
   - Zkontrolovat, zda se `linkedProducts` sprÃ¡vnÄ› naÄÃ­tajÃ­ a renderujÃ­

4. **PÅ™Ã­chutÄ› se neuklÃ¡dajÃ­ do "Moje oblÃ­benÃ©"**
   - `saveFlavorToFavorites()` selhÃ¡vÃ¡ kvÅ¯li chybÄ›jÃ­cÃ­m sloupcÅ¯m (opraveno)
   - Po opravÄ› RLS bude potÅ™eba otestovat celÃ½ flow znovu

**Service Worker:** `liquimixer-v186`

### 10.02.2026 - Opravy bugÅ¯ (pokraÄovÃ¡nÃ­)

**Opraveno:**
1. âœ… CSS tÅ™Ã­dy `.warning` a `.ideal` pro barvu textu pÅ™Ã­chutÄ› v `styles.css`
2. âœ… FinskÃ© pÅ™eklady - `flavor_category_label`, `ideal_specific`, `notes_*`, `flavor_description`
3. âœ… Detail produktu (pÅ™Ã­chutÄ›) - zobrazenÃ­ min%, max%, steep days, manufacturer
4. âœ… `getFavoriteProductById()` - JOIN na flavors tabulku pro parametry pÅ™Ã­chutÄ›
5. âœ… PÅ™eklady pro parametry pÅ™Ã­chutÄ› ve vÅ¡ech jazycÃ­ch (cs, en, fi, hu)

**RLS migrace aplikovÃ¡na uÅ¾ivatelem:** `20260209_fix_recipe_flavors_rls.sql`

### 08.02.2026 - ZjiÅ¡tÄ›nÃ© problÃ©my

**PÅ™eklady ingredientÅ¯ NEFUNGUJÃ sprÃ¡vnÄ›:**
- `sweetener` zobrazuje anglickÃ½ text mÃ­sto pÅ™eloÅ¾enÃ©ho
- `shortfill_base` zobrazuje technickÃ½ klÃ­Ä
- PÅ™Ã­chutÄ› v litevÅ¡tinÄ› zobrazujÃ­ "Watermelon / Meloun"

**Å˜eÅ¡enÃ­:** Upravit `getIngredientName()`:
```javascript
    if (key === 'sweetener') {
        const sweetenerType = ingredient.sweetenerType || 'honey';
        return t(`shisha.sweetener.${sweetenerType}`, sweetenerType);
    }
    if (key === 'shortfill_base') {
        return t('shortfill.base', 'Shortfill bÃ¡ze');
    }
```

### 05.02.2026 - ImplementovÃ¡no

- âœ… SystÃ©m obtÃ­Å¾nosti receptÅ¯ (beginner, intermediate, expert, virtuoso)
- âœ… Filtr obtÃ­Å¾nosti v databÃ¡zi receptÅ¯
- âœ… Oprava hodnocenÃ­ receptÅ¯ (CSS selektory + RLS)
- âœ… Shisha separÃ¡tnÃ­ VG/PG reÅ¾im
- âœ… Seed 35 receptÅ¯ se sprÃ¡vnou strukturou

### 04.02.2026 - ImplementovÃ¡no

- âœ… Sklad produktÅ¯ (stock_quantity v favorite_products)
- âœ… OdstranÄ›nÃ­ duplicitnÃ­ch funkcÃ­ v database.js
- âœ… Oprava `goBackToCalculator()` pro shisha a dilute

---

## Service Worker

- **AktuÃ¡lnÃ­ verze:** `liquimixer-v186`

---

## ğŸ”§ TECHNICKÃ‰ POZNÃMKY

### Clerk + Supabase RLS integrace

**ProblÃ©m (2026-02-09):**
- RLS policies pouÅ¾Ã­vajÃ­ `auth.jwt()->>'sub'` pro ovÄ›Å™enÃ­ uÅ¾ivatele
- Clerk JWT nenÃ­ sprÃ¡vnÄ› nakonfigurovÃ¡n pro Supabase
- Funkce `setSupabaseAuth()` v database.js se snaÅ¾Ã­ nastavit token, ale template `supabaseClient` neexistuje

**MoÅ¾nÃ¡ Å™eÅ¡enÃ­:**
1. V Clerk Dashboard vytvoÅ™it JWT template "supabase" s claims `sub: {{user.id}}`
2. Upravit RLS policies, aby nepouÅ¾Ã­valy `auth.jwt()` ale vlastnÃ­ logiku
3. PouÅ¾Ã­t Supabase service role (mÃ©nÄ› bezpeÄnÃ©)

**DotÄenÃ© tabulky s RLS:**
- `recipe_flavors` - INSERT selhÃ¡vÃ¡
- PotenciÃ¡lnÄ›: `recipes`, `favorite_products`, `reminders`

### Struktura flavor dat v receptu

```javascript
// V ingredients arrayi:
{
  ingredientKey: 'flavor',
  flavorType: 'fruit',           // kategorie
  flavorName: 'Strawberry',      // konkrÃ©tnÃ­ nÃ¡zev
  flavorManufacturer: 'CAP',     // vÃ½robce
  flavorId: 'uuid...',           // ID z veÅ™ejnÃ© DB
  flavorSource: 'database',      // 'database' nebo 'favorites'
  volume: 10,
  percent: 5
}
```

---

*PoslednÃ­ aktualizace: 2026-02-11 (business analÃ½za aktualizovÃ¡na s navÃ½Å¡enÃ­m cen)*
